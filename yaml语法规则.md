

### 一、 YAML 的核心语法规则

图1是编写任何 YAML 文件都必须遵守的**基础法则**，是后续所有内容的前提。

1. **大小写敏感**：
    
    - `name`和 `Name`会被视为两个不同的属性。
        
    
2. **使用缩进表示层级关系**（**最关键规则**）：
    
    - **只能使用空格进行缩进**，**绝对不能使用 Tab 键**。
        
    - 缩进的空格数不重要，但**同一层级的元素必须左对齐**（使用相同数量的空格）。
        
    
    ```
    server:
      port: 8080    # server 下的 port 属性
      servlet:
        context-path: /api # servlet 下的 context-path
    ```
    
3. **键值对分隔符**（**最易错点**）：
    
    - 使用冒号 `:`表示键值对。
        
    - **注意：冒号后面必须紧跟一个空格**，然后再写值。
        
    - **正确**：`name: itcast`
        
    - **错误**：`name:itcast`（这是最常见的错误！）
        
    
4. **注释**：
    
    - 使用井号 `#`开头，其后的内容会被忽略。
        
    

---

### 二、 YAML 的复杂数据结构

 YAML 相比 Properties 文件的巨大优势：**原生支持数组和对象嵌套**。

#### 1. 数组（List）的表示方法

数组用于表示一组有序的值。

**标准写法（块格式）**：使用减号 `-`开头，每个元素占一行，`-`后面有一个空格。

```
subject:
  - Java
  - 前端
  - 大数据
```

这定义了一个名为 `subject`的数组，包含三个元素。

**缩略写法（流格式）**：使用方括号 `[]`，元素用逗号分隔。

```
likes: [王者荣耀, 刺激战场]
```

这等价于块格式的写法。

#### 2. 对象（Map）的表示与嵌套

YAML 天然支持对象的嵌套，这是其结构清晰的关键。

**简单对象**：

```
enterprise:
  name: itcast
  age: 16
```

这定义了一个 `enterprise`对象，它有两个属性。

**复杂嵌套（对象中包含数组）**：

```
enterprise:
  name: itcast
  age: 16
  subject:      # enterprise 对象下有一个 subject 数组
    - Java
    - 前端
    - 大数据
```

**对象数组**：

```
users:
  - name: Tom
    age: 4
  - name: Jerry
    age: 5
```

这定义了一个 `users`数组，数组中的每个元素都是一个对象。

**对象数组的缩略格式**：

```
users2: [ { name: Tom, age: 4 }, { name: Jerry, age: 5 } ]
```

这种写法更紧凑，但可读性不如块格式。

---

### 三、 YAML 支持的数据类型

图3展示了 YAML 原生支持的丰富数据类型，这使得它可以非常自然地表示各种配置值。

| 数据类型           | 示例                                                | 说明                                                 |
| -------------- | ------------------------------------------------- | -------------------------------------------------- |
| **布尔值**        | `TRUE`, `true`, `True`, `FALSE`, `false`, `False` | 不区分大小写。                                            |
| **整数**         | `123`                                             | 十进制。**（支持二进制、八进制和十六进制）**（坑，很可能被SpringBoot自动转化成八进制） |
| **浮点数**        | `3.14`, `6.8523015e+5`                            | 支持科学计数法。                                           |
| **字符串**        | `HelloWorld`                                      | 普通字符串可以直接书写，无需引号。                                  |
| **字符串（带特殊字符）** | `"Hello World"`                                   | 如果字符串包含空格或特殊字符，需要用双引号包裹。                           |
| **空值**         | `~`                                               | 使用波浪线 `~`表示 `null`。                                |
| **日期**         | `2018-02-17`                                      | 格式必须为 `yyyy-MM-dd`。                                |
| **日期时间**       | `2018-02-17T15:02:31+08:00`                       | 日期和时间用 `T`连接，最后是时区。                                |
**代码示例**：

```
# 各种数据类型的配置示例
enabled: true        # 布尔值
port: 8080           # 整数
pi: 3.14159          # 浮点数
name: Application    # 字符串
full-name: "Spring Boot App" # 带空格的字符串
description: ~        # 空值
start-date: 2024-01-01 # 日期
timestamp: 2024-01-01T10:30:00+08:00 # 日期时间
```
#### 转义字符的处理

：“属性值中如果出现转义字符，需要使用双引号包裹”

当配置的值中包含**特殊字符**（如制表符 `\t`、换行符 `\n`或用于引用的 `$`、`{`、`}`等）时，为了确保它们被正确解析，需要用**双引号**将整个值包裹起来。

**代码示例与解析：**

```
# 不使用引号（可能无法正确解析）
lesson: Spring\tboot\tlesson
# Spring 可能会将其视为普通字符串 "Spring\tboot\tlesson"，其中的 \t 不会被转义。

# 使用双引号（正确解析转义字符）
lesson: "Spring\tboot\tlesson"
# Spring 会正确地将 \t 解析为制表符。当程序读取该属性时，值中间会包含制表符。
```

**为什么需要引号？**

- YAML 解析器在遇到未加引号的字符串时，会将其作为普通字符串处理，其中的反斜杠 ``不会被当作转义符。
    
- 用双引号包裹后，YAML 解析器会按照**字符串转义规则**来处理内容，`\t`会被转换为制表符，`\n`会被转换为换行符。
    

**常见需要引号的情况：**

1. **包含转义字符**：如 `\t`（制表符）、`\n`（换行符）、``（反斜杠本身）。
    
2. **包含YAML特殊字符**：如值本身包含 `:`、`#`、`{`、`}`等，这些字符在YAML中有特殊含义，需要用引号包裹以避免解析歧义。
    
3. **强制将值作为字符串处理**：例如，即使 `12345`是数字，如果你用引号 `"12345"`包裹，它就会被当作字符串处理。

### YAML支持变量引用
在配置文件（如 `application.yml`或 `application.properties`）中，我们可以像编程一样使用变量，从而使配置更简洁、更健壮。**在配置文件中可以使用属性名引用方式引用属性**。

这是一种**DRY（Don't Repeat Yourself）** 原则在配置中的体现。它允许你定义一个基础属性（如路径前缀），然后在其他多个属性中复用这个值。

**代码示例与解析：**

```
# 1. 定义基础属性（类似于定义一个变量）
baseDir: /usr/local/fire

# 2. 在其他属性中通过 ${...} 语法引用这个基础属性
center:
  dataDir: ${baseDir}/data    # 结果：/usr/local/fire/data
  tmpDir: ${baseDir}/tmp      # 结果：/usr/local/fire/tmp
  logDir: ${baseDir}/log      # 结果：/usr/local/fire/log
  msgDir: ${baseDir}/msgDir   # 结果：/usr/local/fire/msgDir
```

**工作机制：**

1. Spring Boot 在加载配置文件时，会先解析出 `baseDir`的值为 `/usr/local/fire`。
    
2. 当解析到 `dataDir: ${baseDir}/data`时，它会识别 `${}`语法，并将其中的 `baseDir`**替换**为之前解析好的值 `/usr/local/fire`。
    
3. 最终，`dataDir`属性的值就是拼接后的字符串 `/usr/local/fire/data`。
    

**核心价值：**

- **维护性**：如果基础路径需要修改（例如从 `/usr/local/fire`改为 `/opt/app`），只需修改 `baseDir`这一处，所有引用了它的属性都会自动更新。
    
- **一致性**：确保了相关路径拥有共同的基础前缀，避免拼写错误。
    
- **简洁性**：减少了重复代码。
    

