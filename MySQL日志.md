### 错误日志

#### 一、 错误日志是什么？


> ​**错误日志是MySQL中最重要的日志之一，它记录了当mysqld启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。​**​

- ​**定位**​：它是 MySQL 的**诊断日志**，
    
- ​**内容**​：主要记录三类事件：
    
    1. ​**启动/停止信息**​：数据库实例的启动、关闭过程，包括配置加载、初始化步骤。如果启动失败，原因必在此日志中。
        
    2. ​**严重错误**​：运行时发生的致命性问题（如存储引擎崩溃、无法访问关键文件、内存耗尽等）。
        
    3. ​**关键警告**​：一些可能影响系统稳定性的重要警告信息。
        
    

#### 二、 为什么错误日志至关重要？

图中一句关键提示点明了其价值：

> ​**当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。​**​

- ​**首要排查依据**​：当数据库服务无法启动、连接失败、运行中突然崩溃或出现严重性能问题时，错误日志是**最直接、最快速的线索来源**。它通常会给出明确的错误代码和描述。
    
- ​**问题诊断**​：通过分析错误日志中的时间戳和错误信息，可以精确定位故障发生的**时间**和**根本原因**。
    

#### 三、 如何管理错误日志？

图中所列的是最基础的管理操作：

1. ​**默认设置**（linux）​
    
    - ​**状态**​：​**默认开启**。MySQL 安装后会自动启用错误日志。
        
    - ​**存放路径**​：默认在 `/var/log/`目录下。
        
    - ​**文件名**​：默认名为 `mysqld.log`。
        
    
2. ​**查看日志路径​**​
    
    由于安装方式或配置调整，错误日志的实际路径可能与默认值不同。图中给出了标准查询方法：
    
    ```
    SHOW VARIABLES LIKE '%log_error%';
    ```
    
    - ​**执行结果解读**​：这条命令会返回一个全局变量 `log_error`的值，该值就是当前 MySQL 实例使用的错误日志文件的**完整路径**。这是查找日志的**最可靠方法**。
        
    

#### 实战应用与扩展

掌握了图中的基础概念后，以下是更深入的实践指南：

#### 1. 如何查看错误日志内容？

- ​**命令行查看**​：使用 `tail`, `cat`, `grep`等 Linux 命令。
    
    ```
    # 实时查看最新日志（最常用）
    tail -f /var/log/mysqld.log
    
    # 查找包含 "ERROR" 关键词的日志行
    grep -i "error" /var/log/mysqld.log
    
    # 查看最近100行日志
    tail -n 100 /var/log/mysqld.log
    ```
    

#### 2. 如何配置错误日志？

日志配置通常在 MySQL 的配置文件 `my.cnf`或 `my.ini`中修改。

- ​**主要配置参数**​：
    
    ```
    [mysqld]
    # 指定错误日志文件路径
    log-error = /path/to/your/mysql_error.log
    # 设置日志错误级别 (1: ERROR, 2: WARNING, 3: INFORMATION)
    log-error-verbosity = 2
    ```
    

#### 3. 常见错误日志分析示例

- ​**启动失败**​：日志中可能出现 `[ERROR] Can't start server: Bind on TCP/IP port: Address already in use`，表示端口被占用。
    
- ​**权限问题**​：`[ERROR] Can't read from the '.err' file (Errcode: 13 - Permission denied)`，表示 MySQL 用户对数据目录没有读写权限。
    
- ​**表损坏**​：`[ERROR] Table 'db.table' is marked as crashed and should be repaired`，指示特定表已损坏，需要修复。
    

#### 总结

这张图的核心价值在于强调了错误日志的**基础性、关键性和优先级**。请您牢记：

1. ​**第一反应**​：数据库出问题，​**第一个**就应该去查错误日志。
    
2. ​**定位方法**​：使用 `SHOW VARIABLES LIKE '%log_error%';`找到它的准确位置。
    
3. ​**分析内容**​：重点关注 `[ERROR]`级别的信息，结合时间点进行诊断。
    

掌握错误日志的查看和分析，是每一位数据库开发和管理人员的必备技能。它是您解决 MySQL 疑难杂症的“第一把钥匙”。

### [[二进制日志]]
### 查询日志
开启查询日志会带来显著的 I/O 开销和性能损耗**，因为每次执行 SQL 都需要写磁盘。因此，​**不建议在生产环境中长期开启**，通常只在需要排查特定问题时临时开启。

如果只是为了分析和优化慢查询，更推荐使用 ​**慢查询日志**，它只记录执行时间超过指定阈值的 SQL，对性能影响更小，目标也更明确。
    
 ![[Pasted image 20251104093003.png]]
 ![[Pasted image 20251104093619.png]]
#### 一、 查询日志是什么？

图中给出了明确定义：

> ​**查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。​**​

- ​**功能**​：查询日志会记录下 MySQL 服务器接收到的**每一个客户端连接和执行的每一条 SQL 语句**​（包括 `SELECT`, `SHOW`, `INSERT`, `UPDATE`, `DELETE`, `DROP`等所有操作）。
    
- ​**与二进制日志的区别**​：这是关键点。二进制日志主要记录**更改数据的语句**​（如 DML 和 DDL），用于复制和恢复。而查询日志记录**所有语句**，包括不修改数据的纯查询（如 `SELECT`），更侧重于**审计和问题排查**。
    
- ​**默认状态**​：​**默认情况下，查询日志是未开启的。​**​ 因为记录所有操作会对性能产生一定影响，并产生大量日志，所以需要手动开启。
    

#### 二、 如何开启查询日志？

图中详细说明了开启查询日志的标准步骤，这是通过修改 MySQL 的配置文件来实现的。

​**1. 找到并编辑配置文件**​

- 文件路径通常是 `/etc/my.cnf`（Linux 系统下）。
    
- 使用文本编辑器（如 `vim`）打开此文件。
    

​**2. 添加配置参数**​

在 `[mysqld]`配置段下，添加或修改以下两行参数：

```
[mysqld]
# 该选项用来开启查询日志。可选值：0 或者 1；0 代表关闭，1 代表开启
general_log=1
# 设置日志的文件名，如果没有指定，默认的文件名为 host_name.log
general_log_file=mysql_query.log
```

- ​**`general_log`**​：这是总开关。设置为 `1`即表示开启查询日志。
    
- ​**`general_log_file`**​：指定日志文件的名称和路径。如果不设置绝对路径，则文件会创建在 MySQL 的数据目录（如 `/var/lib/mysql/`）下。图中示例设置为 `mysql_query.log`。
    

​**3. 重启 MySQL 服务**​

修改配置文件后，必须重启 MySQL 服务才能使配置生效。

```
# 根据系统不同，选择相应的命令重启
systemctl restart mysqld
# 或
service mysql restart
```

#### 三、 验证查询日志状态

在配置前后，你可以通过 SQL 命令查看查询日志的当前状态，以确认配置是否生效。

```
-- 查看查询日志是否开启（ON/OFF）及其日志文件路径
SHOW VARIABLES LIKE 'general_log%';
```

执行结果会显示两个变量：

- `general_log`：值为 `ON`或 `OFF`。
    
- `general_log_file`：日志文件的完整路径。
    

#### 总结与注意事项

1. ​**核心价值**​：查询日志是进行 ​**SQL 审计、慢查询分析、业务逻辑排查和操作追踪**​ 的强力工具。通过它，你可以看到数据库上发生的“每一件事”。
    
2. ​**日志管理**​：查询日志会快速增长，需要定期清理或归档，以避免占满磁盘空间。
    


### [[慢查询日志]]

