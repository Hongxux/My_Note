
- ​**功能：​**​ 允许父进程**暂停**自己的执行，​**等待**其子进程终止或停止，并**获取**子进程的退出状态信息。这对于回收子进程资源（避免僵尸进程）和协调父子进程执行顺序至关重要。
    
- ​**工作原理：​**​
    
    - 当父进程调用 `wait()`(或其变体 `waitpid()`) 时：
        
        1. 如果父进程**已经有一个或多个终止的子进程**，`wait()`立即返回其中一个子进程的信息。
            
        2. 如果父进程**没有已终止的子进程**，`wait()`会**阻塞**父进程，直到有一个子进程终止。
            
        3. 当子进程终止时，操作系统会向父进程发送一个 `SIGCHLD`信号（默认忽略），并将子进程的退出状态保存起来。
            
        4. `wait()`​**唤醒**父进程，并返回终止子进程的 ​**PID**，同时通过指针参数（如果提供）填充子进程的**退出状态**​（正常结束的退出码或被哪个信号终止等信息）。
            
        5. 操作系统**回收**终止子进程的大部分资源（进程表项、内存等）。父进程获取退出状态后，子进程彻底消失。
            
        
    
- ​**僵尸进程 (Zombie)：​**​
    
    - 当一个子进程终止时，它不会立即消失。它会变成一个**僵尸进程**，保留在进程表中，直到父进程调用 `wait()`（或 `waitpid()`）获取其状态。
        
    - 僵尸进程不占用内存或 CPU，但占用一个进程 ID (PID)。如果父进程从不调用 `wait()`，僵尸进程会一直存在直到父进程结束（此时僵尸进程被 `init`进程收养并 `wait`，从而被清理）。
        
    - 大量僵尸进程会消耗有限的 PID 资源，因此父进程有责任回收其子进程。
        
    
- ​**`wait()`vs `waitpid()`：​**​
    
    - `wait(int *status)`：等待**任意一个**子进程终止。无法指定具体等待哪个子进程。
        
    - `waitpid(pid_t pid, int *status, int options)`：功能更强大。
        
        - `pid`：指定要等待的子进程 PID。`-1`表示等待任意子进程（类似 `wait`）。`0`表示等待与父进程同进程组的任意子进程。
            
        - `options`：提供额外控制，如 `WNOHANG`（非阻塞，如果没有子进程退出立即返回 0）或 `WUNTRACED`（也报告停止的子进程）。
            
        
    
- ​**返回值：​**​
    
    - 成功：返回状态改变的子进程的 ​**PID**。
        
    - 失败（如没有子进程可等待）：返回 ​**​-1**​（并设置 `errno`）。
        
    - 使用 `WNOHANG`选项且没有子进程退出：返回 ​**0**。
        
    
- ​**关键点：​**​
    
    - 父进程通常使用 `wait()`/`waitpid()`来**同步**子进程的执行（确保子进程完成后再继续）。
        
    - 它是**避免僵尸进程**的主要机制。
        
    - 父进程可以获取子进程的**退出状态**，了解其执行结果（成功/失败/被信号终止）。
        
    
- ​**示例代码片段 (在父进程中)：​**​
    
    ```
    int status;
    pid_t child_pid = fork();
    if (child_pid == 0) {
        // 子进程代码 (例如 exec 一个新程序)
        exit(123); // 子进程退出码
    } else if (child_pid > 0) {
        // 父进程代码
        pid_t terminated_pid = wait(&status); // 阻塞等待子进程结束
        if (WIFEXITED(status)) { // 检查子进程是否正常退出
            printf("Child %d exited with status %d\n", terminated_pid, WEXITSTATUS(status)); // 输出 123
        } else if (WIFSIGNALED(status)) {
            printf("Child %d killed by signal %d\n", terminated_pid, WTERMSIG(status));
        }
    }
    ```
    