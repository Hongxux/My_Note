## 一、什么是缓存雪崩？

**缓存雪崩**是指缓存中**大量的数据在同一时间点或短时间内集中过期**，导致所有请求都直接涌向数据库，数据库瞬时压力过大甚至宕机，进而引发整个系统崩溃的连锁反应。
![[Pasted image 20251118215637.png]]

---
## 二、缓存雪崩的两个主要原因

### 原因1：大量缓存同时过期

这是最常见的原因，具体表现为：

|场景|示例|后果|
|---|---|---|
|**批量数据加载**|服务启动时批量加载数据到缓存，设置了相同的TTL|所有缓存将在同一时刻失效|
|**固定时间刷新**|每日凌晨定时刷新所有缓存|凌晨时刻所有缓存同时重建|
|**相同的过期策略**|所有商品缓存都设置为30分钟过期|30分钟后集体失效|
### 原因2：缓存服务宕机

这是更极端但危害更大的情况：

|场景|原因|影响|
|---|---|---|
|**Redis节点宕机**|硬件故障、网络问题、内存不足|整个缓存层不可用|
|**缓存集群故障**|主从切换失败、集群脑裂|所有缓存请求失败|
|**机房故障**|电力中断、自然灾害|区域性缓存服务中断|

----

## 三、缓存雪崩的处理方案


### 针对同时失效：
- 给不同的Key的TTL添加随机值
```java
// 基础时间 ± 随机偏移量（基础时间的20%）
    long baseSeconds = timeUnit.toSeconds(baseTime);
    long randomOffset = (long) (baseSeconds * 0.2 * Math.random()); // ±20%的随机偏移
    long finalTtl = baseSeconds + (Math.random() > 0.5 ? randomOffset : -randomOffset);
```
### 针对Redis宕机：

- 利用 **[[Redis集群]]** 提高服务的可用性
- 给缓存业务添加 **[[降级限流]]** 策略
	- 快速失败，拒绝服务
 - 给业务添加 **[[缓存#^e609a6|多级缓存]]**
 