---
aliases:
  - 双写缓冲区
---

- ​**问题背景**​：操作系统和磁盘硬件以“块”为单位进行写入（如 4KB），而 InnoDB 数据页通常是 16KB。如果发生部分页写入（例如写入16KB时只写了8KB后断电），会导致页数据损坏，即使有重做日志也无法恢复，因为重做日志的恢复依赖于页本身的完整性。
    
- ​**解决方案**​：
    
    1. 在将脏页刷到表空间数据文件**之前**，InnoDB 会先将它们顺序地写入磁盘上一个名为双写缓冲区的连续区域。
        
    2. 然后再将脏页散落地写入其真正的数据文件位置。
        
    
- ​**崩溃恢复**​：如果发生部分页写入，InnoDB 可以从双写缓冲区中找到该页的一个完好副本，用它来恢复损坏的页。
    
- ​**性能权衡**​：双写机制会增加一次额外的磁盘写入，但通过顺序写入来降低性能开销。在支持原子写的现代存储设备上可以考虑关闭。