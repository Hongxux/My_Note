![[Pasted image 20251122170643.png]]
### RDB持久化
 ![[Pasted image 20251122161527.png]]
 RDB持久化的时机:
 - 命令行主动持久化![[Pasted image 20251122162420.png]]
 - 内部**触发**RDB持久化![[Pasted image 20251122162530.png]]![[Pasted image 20251122162659.png]]
 - 主动关闭Redis服务器的时候持久化![[Pasted image 20251122162515.png]]
RDB的原理
![[Pasted image 20251122165057.png]]
  异步执行
  1. 
	 - 问题:如果备份进程在进行读操作的时候，主进程写内存，那会出现脏数据
	 - 解决方案：使用copy-on-write技术
		 - 主进程写的时候：拷贝一份数据副本，进行写操作
		 - 主进程读的时候
			- 如果是被拷贝过的数据，则读取该数据副本
			- 如果是未被拷贝过的数据，则读取原数据即可
2. 
	- 问题：如果出现备份的时候，有大量主进程写内存的操作，则需要备份的数据极大，可能出现内存溢出
	- 解决方案：预留一部分内存
  
RDB的缺点
- RDB执行间隔时间长，两次RDB之间写入数据有丢失的风险
- fork子进程、压缩、写出RDB文件都比较耗时
### AOF持久化

AOF全称为Append Only File(追加文件)。Redis处理的每一个写命令都会记录在AOF文件，可以看做是命令日志文件。
![[Pasted image 20251122165540.png]]

开启AOF，配置AOF重写模式 

![[Pasted image 20251122165801.png]]
![[Pasted image 20251122165923.png]]





![[Pasted image 20251122170216.png]]

![[Pasted image 20251122170345.png]]