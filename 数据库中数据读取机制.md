---
aliases:
  - 当前读
  - 快照读
---
- 当前读

| 特性         | 当前读                                         | 快照读             |
| ---------- | ------------------------------------------- | --------------- |
| ​**读取目标**​ | 数据的最新提交版本                                   | 历史的一致性数据快照      |
| ​**是否加锁**​ | ​**是**​（共享锁或排他锁）                            | ​**否**​         |
| ​**并发性能**​ | 较低（会阻塞写操作）                                  | ​**极高**​（读写不阻塞） |
| ​**核心保证**​ | 数据的**强一致性**​                                | 读的**非阻塞和高并发**​  |
| ​**典型操作**​ | `SELECT ... FOR UPDATE`, `UPDATE`, `DELETE` | 普通的 `SELECT`    |
| ​**实现技术**​ | 锁（Locking）                                  | 多版本并发控制（MVCC）   |

### 一、 当前读

#### ​**1. 核心定义**​

当前读是一种**悲观锁**的实现方式。它要**确保**自己读取到的数据是**绝对最新**的，并且在读取的瞬间就**阻止其他事务并发修改**这些数据，以保证数据的一致性。

#### ​**2. 操作方式与加锁类型**​

- ​**操作**​：通过在 SELECT 语句后加锁指令，或直接执行写操作。
    
    - `SELECT ... LOCK IN SHARE MODE;`（加**共享锁**）
        - ​**共享锁**​：允许其他事务也加共享锁来读，但阻止任何事务加排他锁来写。
    - `SELECT ... FOR UPDATE;`（加**排他锁**）
        - ​**排他锁**​：最严格的锁，阻止其他事务加任何锁（既不能读也不能写）。
        
    - `INSERT`, `UPDATE`, `DELETE`（这些操作本身会隐式地对涉及的数据加**排他锁**）


#### ​**3. 应用场景**​

- ​**余额扣减**​：`SELECT balance FROM account WHERE id = 1 FOR UPDATE;`确保查询余额后，在事务提交前，其他事务无法修改此余额，防止超扣。

- ​**库存检查与预留**​：在生成订单时，先通过当前读锁定库存，防止超卖。
    

### 二、 快照读

#### ​**1. 核心定义**​

快照读是 InnoDB 实现**高并发读**的关键——**多版本并发控制（MVCC）​**​ 的具体体现。它读取的不是数据的最新版本，而是**事务开始时的某个一致性快照**。它**不加锁**，因此不会阻塞其他事务的读写操作。

#### ​**2. 操作方式**​

- ​**操作**​：普通的 `SELECT`语句（不加任何锁）。
    
- ​**实现原理**​：InnoDB 通过 ​**Undo Log**​ 链为每个事务在启动时构造一个**一致性视图**。即使其他事务修改了数据，当前事务仍然能看到它开始时的数据版本。
    
​
#### 实践建议

1. ​**默认使用快照读**​：在大多数查询场景下，使用普通的 `SELECT`（快照读）以获得最佳并发性能。
    
2. ​**谨慎使用当前读**​：仅在需要**绝对确保**在后续操作前数据不被更改的“先查后改”场景中（如支付、库存扣减），才使用 `SELECT ... FOR UPDATE`等当前读操作，因为它会影响并发。
    
3. ​**理解隔离级别**​：根据业务对一致性的要求选择合适的隔离级别。默认的**可重复读**级别在保证数据一致性和并发性能之间取得了很好的平衡。