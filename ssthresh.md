`ssthresh`是 TCP 拥塞控制算法中一个**至关重要**的状态变量，它标志着 TCP 行为模式的切换。理解它对于掌握 TCP 的拥塞控制逻辑至关重要。

---

### ​**一、核心定义**​

​**`ssthresh`**​（全称 ​**Slow Start Threshold**，慢启动阈值）是一个动态变化的阈值，其单位为**字节**。它决定了 TCP 拥塞控制算法在两种核心模式之间的切换：

1. ​**`cwnd < ssthresh`**​：TCP 使用 ​**慢启动（Slow Start）​**​ 算法。
    
2. ​**`cwnd >= ssthresh`**​：TCP 使用 ​**拥塞避免（Congestion Avoidance）​**​ 算法。
    

它的核心作用是：​**指导 TCP 如何增长其拥塞窗口（`cwnd`），从而控制数据发送速率。​**​

---

### ​**二、初始值与动态更新**​

#### ​**1. 初始值**​

在 TCP 连接刚建立时，`ssthresh`会被设置为一个**非常大的值**​（例如 65535 字节）。这个初始值的意义是：​**在连接开始时，默认让 TCP 先进入慢启动阶段，以指数增长方式快速探测网络可用带宽。​**​

#### ​**2. 动态更新（关键！）​**​

`sshtresh`的值并非固定不变。它会在**检测到拥塞**时被动态更新，其更新规则是 TCP 拥塞控制的智慧体现：

​ **`ssthresh = max(flight_size / 2, 2 * MSS)`** **​

- **​`flight_size`** ：指的是当前在网络中正在传输（已发送但未被确认）的数据量。在大多数实现中，这个值近似等于当前的拥塞窗口大小 `cwnd`。因此，规则通常简化为：
    
    ​**`ssthresh = max(cwnd / 2, 2 * MSS)`**​
    
- ​**`2 * MSS`**​：确保 `ssthresh`至少为 2 个最大报文段长度，这是为了保持 TCP 的“ACK 自时钟”机制能继续工作。
    

​**这个更新发生在何时？​**​

当 TCP ​**检测到拥塞**时。根据检测方式的不同，分为两种情况：

1. ​**发生超时重传（RTO）​**​：这是最强烈的拥塞信号。TCP 会立即执行：
    
    - `ssthresh = max(cwnd / 2, 2 * MSS)`
        
    - `cwnd = 1 * MSS`（并进入慢启动阶段）
        
    
2. ​**触发快速重传**​（收到3个重复ACK）：这是相对温和的拥塞信号。TCP 会执行：
    
    - `ssthresh = max(cwnd / 2, 2 * MSS)`（这就是**快速恢复**算法的一部分）
        
    - `cwnd = ssthresh + 3 * MSS`（然后进入拥塞避免阶段）
        
    

---

### ​**三、`ssthresh`的工作原理与作用**​

为了更直观地理解 `ssthresh`在整个 TCP 连接生命周期中如何动态调节拥塞窗口 (`cwnd`) 的增长策略，我们可以参考以下流程图，它展示了一个连接从建立到经历拥塞的完整过程：

`ssthresh`的核心作用是 ​**​“记忆”​**​ 。它记录了 TCP 连接在最近一次发生拥塞时，网络承载能力的一半（`cwnd / 2`）。这个值被 TCP 视为一个 ​**​“安全边界”​**。

- ​**在慢启动阶段**，TCP 可以“大胆地”以**指数增长方式**快速探索，直到接近这个安全边界。
    
- ​**在拥塞避免阶段**，TCP 必须“谨慎地”以**线性增长方式**慢慢接近这个边界，避免再次冲垮网络。
    

这种 **“大胆探索 -> 谨慎逼近”** 的循环，使得 TCP 能够动态地适应网络带宽的变化。

---

### ​**四、`ssthresh`与 `cwnd`的区别**​

这是一个非常重要的概念区分：

| ​**特性**​   | ​**`ssthresh`(慢启动阈值)​**​            | ​**`cwnd`(拥塞窗口)​**​                                                                                   |
| ---------- | ----------------------------------- | ----------------------------------------------------------------------------------------------------- |
| ​**角色**​   | ​**策略制定者**​：决定使用哪种窗口增长算法。           | ​**战术执行者**​：直接控制每次能发送的数据量。                                                                            |
| ​**更新时机**​ | 主要在**检测到拥塞时**更新。                    | ​**持续更新**​：每收到一个ACK都可能更新。                                                                             |
| ​**更新规则**​ | `ssthresh = max(cwnd / 2, 2 * MSS)` | 慢启动：`cwnd += MSS`  （在一个RTT内翻倍，分配到每次接受ACK就是增加一个MSS大小）<br>拥塞避免：`cwnd += MSS / cwnd`（在一个RTT内增加一个，进行相信增长） |
| ​**主要作用**​ | ​**记录历史经验**，定义安全边界。                 | ​**实时控制**当前的发送速率。                                                                                     |

---

### ​**五、面试官关心的问题与答案**​

​**面试官**​：“谈谈你对 `ssthresh`的理解。”

​**你的回答**​：

“`ssthresh`是 TCP 拥塞控制中的**慢启动阈值**，它是一个动态更新的值，核心作用是**决定 TCP 在慢启动和拥塞避免两种增长模式之间切换**。”

“它的更新规则是：​**在检测到拥塞时（如超时或收到3个重复ACK），`ssthresh`会被设置为当前拥塞窗口的一半和2倍MSS中的较大值**，即 `ssthresh = max(cwnd / 2, 2 * MSS)`。这个新值代表了TCP对当前网络可用带宽的**最新估计**。”

“在连接初期，`ssthresh`被设为一个很大的值，让TCP先通过慢启动指数增长快速探测带宽。之后，它会根据网络状况动态调整。​**`ssthresh`记录了过去的拥塞经验，为接下来的传输设定了一个安全增长的目标**，而 `cwnd`则是在这个目标指导下进行实时调整的具体执行者。”

这个回答展示了你对机制、时机和目的的全方位理解。