---
aliases:
  - Undo Log
---
- 需求背景：
	- 事务回滚需求：
		- 时机：当事务执行过程中发生错误或需要回滚时
		- 标准：将数据恢复到事务开始前的状态
	- MVCC实现需求：在高并发环境中，需要支持多个事务同时读取数据而不互相阻塞
		- 实现"读不加锁、写不阻塞读"的并发控制
	- 隔离性保障需求：确保事务在并发执行时能够看到一致的数据视图
		- 支持不同的事务隔离级别（如读已提交、可重复读）
- 日志记录的内容：根据操作类型不同，存储内容各异：
    - INSERT操作：存储主键信息，回滚时执行删除
    - DELETE操作：存储完整记录，回滚时执行插入
    - UPDATE操作：存储被修改前的内容，回滚时恢复旧值
- 逻辑组织方式：
	- [[undo log的版本链]]
- 存储方式：
	- 磁盘存储文件：通常为 `ib_logfile0`和 `ib_logfile1`
		- 写入方式：
			- 循环写入 ：`ib_logfile0`和 `ib_logfile1`两文件循环写入
			- 顺序追加：比随机写入数据页要快得多
		- 配置：
			- `innodb_log_file_size`控制文件大小
			- `innodb_log_files_in_group`控制文件数量
	- 内存存储区域： ​Log Buffer
		-  ​管理单元​：Undo Log 采用**段**​ 的方式进行管理。
		- ​存储位置​：存放在回滚段​ 中。一个回滚段中包含多个 ​Undo Log Segment。
	- 持久化步骤：
		1.  当数据发生变更时，变更产生的**重做日志**会先被写入 ​**Log Buffer**。
	    2. 根据策略（如事务提交时），日志被顺序、批量地刷入这些重做日志文件。