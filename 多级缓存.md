- 分布式缓存，例如Redis:
	- 优点:存储容量更大、可靠性更好、可以在集群间共享
	- 缺点:访问缓存有网络开销
	- 场景:缓存数据量较大、可靠性要求较高、需要在集群间共享

- 进程本地缓存，例如HashMap、GuavaCache、[[Caffeine]]:
	- 优点:读取本地内存，没有网络开销，速度更快
	- 缺点:存储容量有限、可靠性较低、无法共享
	- 场景:性能要求较高，缓存数据量较小
## 多级缓存的需求背景
传统的缓存策略一般是请求到达Tomcat后，先查询Redis，如果未命中则查询数据库，存在下面的问题:![[Pasted image 20251124192925.png]]
- 请求要经过Tomcat处理，Tomcat的性能成为整个系统的瓶颈
- Redis缓存失效时，会对数据库产生冲击 

解决方案：多级缓存
![[Pasted image 20251125141636.png]]

## 搭建多级缓存
### 1.进程缓存
指的是首次在数据库中查询，然后使用Caffeine实现进程缓存，然后下次查询就可以在缓存中查询数据而不经过Caffeine
### 2.配置多台Tomcat
[[在IJ中配置多个SpringBoot服务实例]]
### 3.配置tomcat负载均衡
![[Pasted image 20251125125536.png]]
这里的访问方式是轮询，会导致进程缓存失效
解决方法：修改负载均衡算法([[一致性哈希]])，对请求路径hash取模，分配进程
	![[Pasted image 20251125131823.png]]
	```
	    upstream tomcat-cluster{  
	        hash $request_uri consistent;  
	        server 192.168.0.101:8081;  
	        server 192.168.0.101:8082;  
	    }
	                proxy_pass http://tomcat-cluster;
	```
### 4.[[nginx本地缓存]]

### 5.Redis缓存
lua脚本操作redis实现
[[lua脚本#^ed53aa]]
#### [[缓存预热]]
![[Pasted image 20251125133017.png]]





## [[缓存同步]]（一致性）

