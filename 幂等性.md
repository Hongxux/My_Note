---
aliases:
  - 幂等
---
- 含义：**对于同一操作的多次执行，其对系统状态产生的影响，与仅执行一次的影响是相同的**。
	- 幂等：查询和删除
	- 不幂等：新增和修改
- 需求背景：不可避免的重复
	- **网络不确定性**：在分布式系统中，服务间的调用很可能因为网络延迟、抖动或临时故障而失败。调用方（如上游服务或网关）在未及时收到响应时，通常会采取**重试机制**。如果服务端接口不具备幂等性，每次重试都可能被视为一个新请求进行处理，从而导致数据被多次修改（如重复扣款、重复扣减库存）
	- **用户误操作导致多个相同请求**：用户在使用应用时，可能因未及时收到反馈（如页面卡顿）而**多次点击提交按钮**（如支付、下单），从而向后台发送了多个内容相同的请求
	- **消息消费失败的多次重复消费**：在使用消息队列（如RabbitMQ、Kafka）进行异步处理时，由于消息确认机制或消费者故障，同一条消息可能存在**被多次投递和消费**的风险。幂等性是确保消息不被重复处理的关键
	- **系统恢复与补偿**：在复杂的业务流程中，系统在故障恢复后可能需要执行补偿或重试操作（如Saga模式）。幂等性可以确保这些恢复机制**安全地执行**，而不会因重复执行对数据状态造成破坏
- 解决措施：
	- 用户误操作导致多个相同请求
		- [[token机制实现幂等性]]
	- 消息消费失败的多次重复消费：主要是避免重复新增和修改
		- 先查后改：
			- 乐观锁CAS
			- Redis的lua脚本实现原子操作