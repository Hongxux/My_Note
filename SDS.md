---
aliases:
  - 动态字符串
---
- 需求背景：
	- Redis中字符串是最常用的一种数据结构
	- C语言自带的字符串存在很多问题：![[Pasted image 20251126150240.png]]
		- 获取字符串长度的需要通过运算
			- 需要遍历直至遇到'\0'，O（n）时间复杂度
		- 非二进制安全
			- 不能包含特殊字符'\0'
			- 
		- 不可修改
			- “”的字符串称为字符串的字面值，存放在常量池
- 解决方案：Redis构建了一种新的字符串结构，称为简单动态字符串(Simple Dynamic String)，简称SDS。


- SDS的结构![[Pasted image 20251126152254.png]]
	- len
		- O（1）获取字符串长度
		- 二进制安全
			- 知道读多少位（len）停止，而不依赖于‘\0’标识符
	- alloc：是内存自动扩容的基础
	- flags:SDS为了满足不同的存储长度而分类![[Pasted image 20251126152117.png]]


- SDS自动扩容：内存预分配
	- 第一次声明SDS的时候：len=alloc
	- 追加字符串的时候，进行内存预分配：
		- 如果新字符串小于1M，则新空间为扩展后字符串长度的两倍+1（+1是'\0'）
		- 如果新字符串大于1M，则新空间为扩展后字符串长度+1M+1
	- 内存预分配的原因：申请内存需要在用户态和内核态进行交互，频繁申请会降低性能
 
