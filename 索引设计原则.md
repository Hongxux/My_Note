
### 数据库索引优化七大准则详解

#### 1. 为合适的表创建索引

- ​**准则**​：针对于数据量较大，且查询比较频繁的表建立索引。
    
- ​**解读**​：索引不是必须的。对于数据量小或很少被查询的表，创建和维护索引的开销可能大于其带来的性能收益。应优先为**数据量大**且**访问频繁**的核心表建立索引。
    

#### 2. 为合适的字段创建索引

- ​**准则**​：针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引。
    
- ​**解读**​：索引的目的是加速数据检索。因此，应聚焦在那些真正参与查询过滤（`WHERE`）、排序（`ORDER BY`）和分组（`GROUP BY`）的字段上。
    

#### 3. 选择高区分度的列建索引

- ​**准则**​：尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。
    
- ​**解读**​：​**区分度**​ 指列中不重复值的个数占总记录数的比例。例如，“性别”列只有两三种值，区分度极低，对其建索引几乎无效。而“身份证号”或“手机号”区分度接近1，索引效率极高。应优先选择高区分度的列。
    

#### 4. 对长字符串使用前缀索引

- ​**准则**​：如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。
    
- ​**解读**​：为很长的`VARCHAR`或`TEXT`字段建索引，会使得索引文件巨大。通过只对字段的前`n`个字符建立索引（前缀索引），可以大幅节省空间，且能保证一定的查询效率。关键是选择合适的前缀长度，以平衡空间和效率。
    

#### 5. 优先使用联合索引

- ​**准则**​：尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。
    
- ​**解读**​：这是非常重要的一条。当查询条件涉及多个字段时，一个设计良好的联合索引 `(A, B, C)`远比三个独立的单列索引有效。它不仅符合**最左前缀法则**来加速多条件查询，更关键的是可以实现**覆盖索引**​（查询的列全部包含在索引中），从而避免耗时的**回表**操作。
    

#### 6. 控制索引的数量

- ​**准则**​：要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。
    
- ​**解读**​：索引是一把双刃剑。每个索引在`INSERT`、`UPDATE`、`DELETE`操作时都需要被更新。过多的索引会显著降低数据写入和修改的性能，并占用额外磁盘空间。需要根据实际查询需求，精简单表上的索引总数。
    

#### 7. 使用NOT NULL约束

- ​**准则**​：如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。
    
- ​**解读**​：定义`NOT NULL`不仅是一种数据完整性约束，也能帮助查询优化器生成更优的执行计划。因为包含`NULL`值的列会使优化器的计算变得更复杂，而明确的`NOT NULL`约束提供了更确定的信息，有助于索引选择。
    

### 总结

这七条准则构成了一个完整的索引优化思维框架：

- ​**时机与目标**​（准则1、2）：明确为何表、为何字段建索引。
    
- ​**字段选择**​（准则3）：在目标字段中，选择效果最好的。
    
- ​**技术选型**​（准则4、5）：针对字段特点（是否很长？是否总一起查询？）选择最合适的索引类型（前缀索引或联合索引）。
    
- ​**全局权衡**​（准则6、7）：在追求查询速度的同时，必须考虑写入性能和数据定义对优化器的辅助作用。
    

遵循这些准则可以有效指导你设计出高性能、易维护的数据库索引方案。