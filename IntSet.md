- 最大的特点是根据节约空间，根据存储的数字的大小，采取合适的编码，节约空间。
- 而且可以如果新的数字超过原来编码的大小范围，可以自动进行动态进行扩容
- IntSet的结构：![[Pasted image 20251126153957.png]]
	- encoding包含三种模式![[Pasted image 20251126154014.png]]
		- 统一编码格式：方便intset角标寻址，即使出现了编码方式升级
			- 不需要保存额外的指针，类似于数组结构
		- 编码方式升级：
			- 时机：插入了一个超过目前编码的范围
			- 改变：
				- 确定新编码：升级编码到合适的大小，改变len和encoding信息
				- 分配新内存：按照新的编码方式以及元素个数，扩容数组，申请内存空间‘
				- 迁移原有数据：**倒序**依次将数组中的元素拷贝到扩容后的正确位置
					- 倒叙：能避免覆盖未拷贝的数据
				- 插入新元素：由于新元素必然大于或小于原有集合中的所有元素（引起了编码升级），它会被放在升级后新数组的开头（负数）或末尾（正数）
	- contents 
		- 本质：是一个指向第一个元素的指针
			- Redis自己实现数组的增删改查
			- 其数据类型并不限制其存储元素的个数大小
		- 特性：
			- 升序存储：为了方便查找，存储的整数按照升序保存在contents中
			- 查找方式：二分查找，O（log n）
			- 元素唯一：在插入前进行查找，确保集合内**没有重复元素**

- IntSet的插入新元素流程：
	1. 编码升级和判断
	2. 二叉查找：
		1. 判断是否重复，重复则不插入
		2. 不重复判断新元素位置
	3. 插入新元素
		- 数组扩容：调整集合大小，为新增的元素分配空间。
		- 移动元素：将 `pos`位置及之后的所有元素向后移动一个单位，腾出空间。
		- 设置新值：将新值存入 `pos`位置。
		- 更新长度：将集合的长度（`length`）加1
