
在出现发送方连续收到3个或3个以上对同一序列号的重复ACK的时候，怀疑该序列号的数据包已经丢失了
## ​**一、快速重传 (Fast Retransmit)​**​
### 传统快速重传：
#### ​**1. 核心定义**​

快速重传是一种基于**接收端反馈**的丢包探测与修复机制。它通过监听**重复确认（Duplicate ACK, Dup-ACK）​**，在重传计时器（Retransmission Timeout, RTO）超时之前，主动推断并重传疑似丢失的数据段。

#### ​**2. 触发条件与判定**​

触发条件为：​**发送方连续收到3个或3个以上对同一序列号的重复ACK**。

- ​**重复ACK的生成机制**​：当接收方收到一个**失序报文段**​（其序列号高于当前期望的接收序号`rcv_nxt`）时，根据RFC 5681，它必须立即生成一个**重复ACK**，其中的**确认号字段（Acknowledgment Number）​**​ 为当前已按序接收的最大序列号+1。
    
- ​**阈值“3”的合理性**​：这是一个经验值，旨在**高概率地区分数据包丢失与网络短暂乱序**。少量（1-2个）Dup-ACK很可能由路径抖动引起，而连续3个及以上则极大概率表明该序列号的数据包已丢失。
    

#### ​**3. 协议行为**​

一旦判定条件满足，发送方**立即执行重传**，而无需等待重传计时器超时。这显著减少了丢包恢复延迟（从数百毫秒的RTO降至毫秒级）。

---

### 现代快速重传：[[基于SACK的拥塞控制]]
## ​**二、快速恢复 (Fast Recovery)​**​

#### ​**1. 核心定义**​

- 快速恢复是紧接在快速重传之后执行的**拥塞控制算法**。其核心目标是在进行丢包重传期间，​**保持网络中的数据流（Keep the Pipe Full）​**，避免拥塞窗口（`cwnd`）过度收缩至1 MSS，从而维持较高的吞吐量。旨在维持数据流并修复多个丢包的**状态阶段**。
- **面临的问题：**
	1. **网络状态未知：​**​ 刚刚发生了拥塞，现在状况如何？
    
	2. ​**其他丢包待查：​**​ 只有刚刚重传的包丢了吗？后面有没有包也丢了，但发送方还不知道！
#### ​**2. 算法流程与状态管理**​

当发送方触发快速重传时，它同步执行以下拥塞状态更新：

1. ​**记录当前网络容量**​：
    
    [[ssthresh]] = max(cwnd / 2, 2 * MSS)`
    
    - 将**慢启动阈值**设置为当前拥塞窗口的一半（但至少为2个MSS）。这记录了发生拥塞前网络容量的估计值。
        
    
2. ​**调整拥塞窗口**​：
    
    `cwnd = ssthresh + 3 * MSS`（**此时既不处于慢启动，也不处于拥塞避免阶段，而是处于一个独立的、短暂的“快速恢复”阶段。​**​ 这个阶段结束后，TCP会立即**进入拥塞避免阶段**）。
    
    - **​`ssthresh`**：将窗口收缩到安全水平。
        
    - **​`+ 3 * MSS`**：这是一个**关键优化**。加上的3个MSS对应于已离开网络并触发3个Dup-ACK的3个数据包。接收方已成功接收这些包，表明它们不再消耗网络资源。因此，发送方可以立即将这三个“空位”用于新的传输，​**维持数据流的连续性**。
        
- **Reno算法下：**
	3. ​**重传与持续更新**​：
	    
	    - 发送方重传疑似丢失的数据段。
	        
	    - 此后，​**每收到一个额外的Dup-ACK**，意味着又有一个数据包被成功交付，因此执行 `cwnd = cwnd + MSS`。这进一步补偿了网络中减少的数据包，确保在网络中维持恒定的数据量。
	        
	    
	4. ​**恢复至拥塞避免**​：
	    
	    - 当收到一个**部分确认（Partial ACK）​**​（其确认号高于重传序列号但未完成全部确认）或一个**完全确认（Full ACK）​**​（确认了重传序列号之后的所有数据）时，表明丢失的数据包已被成功修复，失序队列已被理顺。
	        
	    - 此时，设置 `cwnd = ssthresh`，并**退出快速恢复阶段，进入拥塞避免（Congestion Avoidance）状态**。
	        
#### 问题一：**多个包丢失问题**
**解决方案**：​
- **[[NewReno#^81b3ae|NewReno算法：]]：**对传统Reno**快速恢复**阶段的**增强**。它**不依赖SACK选项**。
#### 问题二：**[[尾部丢失问题]]**
**解决方案**：​
- **[[尾部丢失探测（TLP）​]]**



---

## ​**三、协同工作与总结**​

快速重传与快速恢复共同构成了TCP对**非严重拥塞**​（如单个包丢失）的高效响应机制。

1. ​**分工**​：
    
    - ​**快速重传**​：解决**丢包检测与修复**的速度问题（**何时重传**、**重传什么**）。
        
    - ​**快速恢复**​：解决重传期间的**速率控制**问题（**如何发送**），避免性能骤降。
        
    
2. ​**协同**​：
    
    快速重传的触发是快速恢复执行的**前提**。快速恢复依赖于快速重传提供的**明确丢包信号**​（3个Dup-ACK）来智能地调整拥塞状态，而非盲目地回退到慢启动。
    
3. ​**性能提升**​：
    
    这种机制使TCP能够在**微秒至毫秒级**的时间内响应丢包，并在修复过程中保持网络管道的高利用率，是现代TCP实现高吞吐量、低延迟的关键设计。
