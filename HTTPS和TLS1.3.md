HTTPS协议本质上是HTTP协议和SSL/TLS 协议的组合![[Pasted image 20251123215813.png]]
- SSL 是 “Secure Sockets Layer” 的缩写，中文意思为“安全套接层”，而 TLS 则是标准化之后的 SSL。
- TLS提供的功能有三个：
	- 数据私密性：使用对称加密算法用于加密数据的传输
	- 数据完整性：发送的每个消息都使用 MAC（消息认证码） 进行完整性检查
	- 通信方身份的可靠性：使用公钥加密来验证通信方的身份



# TLS 1.2的完整握手
​
![[Pasted image 20251123221207.png]]


## 基于ECDHE的四次TLS握手协议

[图解 ECDHE 密钥交换算法-CSDN博客](https://blog.csdn.net/m0_50180963/article/details/113061162)
1. **初始问候与协商**：客户端首先向服务器发送`Client Hello`消息，包含自己支持的TLS版本、可用的加密算法组合（称为“密码套件”），以及一个**客户端随机数**。服务器回应`Server Hello`消息，从中选定一个双方都支持的密码套件，并生成一个**服务器随机数**，一并发送给客户端
2. **身份验证与密钥交换**：紧接着，服务器会将其**数字证书**发送给客户端。证书由受信任的第三方机构（CA）签发，其中包含了服务器的公钥和身份信息。客户端会验证该证书的合法性，确认自己正在与真实的服务器通信，而非中间人。验证通过后，客户端会生成一个 **“预主密钥”**，并用服务器证书中的公钥进行加密，然后发送给服务器。只有持有对应私钥的服务器才能解密出这个预主密钥
3. **生成会话密钥**：现在，客户端和服务器都拥有了三个要素：客户端随机数、服务器随机数和预主密钥。双方将使用相同的算法，独立计算出用于本次会话的**主密钥**，进而派生出相同的**对称会话密钥**。至此，握手阶段完成，后续所有的应用数据都将使用这个对称密钥进行加密和解密。
   
- 最终会话密匙（对称加密）的生成：由「客户端随机数 + 服务端随机数 + x（ECDHE 算法算出的共享密钥） 」三个材料生成的
	- 使用`ClientRandom`+ `ServerRandom`+ `ECDHE 算法算出的共享密钥`，通过[[伪随机函数（PRF）]]​**​ 生成48字节`MasterSecret`
		- [[ClientRandom与ServerRandom在SSL、TLS握手中的必要性|为什么要用ClientRandom和ServerRandom]]
-  [[证书]]确保公开密匙的真实性

- **非对称加密（用于握手）**：在此阶段用于加密预主密钥和验证服务器身份。它的特点是加密和解密使用不同的密钥（公钥和私钥），安全性高，但计算速度较慢
- **对称加密（用于传输）**：握手完成后，双方使用共享的会话密钥进行高速的对称加密通信   。对称加密算法（如AES）加解密速度快，非常适合加密大量数据
- **数字证书（用于信任）**：是防止“中间人攻击”的关键。它就像服务器的“电子身份证”，由CA机构颁发，证明了公钥持有者的合法身份。浏览器和操作系统中都预置了受信任的根证书，用于验证服务器证书的真实性
