---
aliases:
  - 分库分表
  - Mycat
---
- 需求背景：单体数据库的瓶颈: **高并发压力**（QPS过高）、**大数据量存储与查询**（数据量过大）
	- IO瓶颈
		- ​**根源**​：数据量远超内存容量。
		- ​**表现**​：
			- **磁盘IO瓶颈**：​频繁访问的数据太多，无法全部缓存在内存中
				- 大量请求需要直接读写磁盘，速度极慢。
			- ​**网络IO瓶颈**​：请求的数据量太大，导致网络带宽成为瓶颈。
	- CPU瓶颈（数据处理瓶颈）
		- ​**根源**​：复杂的计算和高并发的请求。
			- ​**SQL问题**：复杂的查询（如包含`JOIN`, `GROUP BY`、非索引字段条件查询）会大量消耗CPU资源。
			- ​**数据量问题**：单表数据量过大（例如达到千万级别），即使简单的查询也需要扫描大量数据
- 解决措施：分库分表：将数据分散存储，使得单一数据库/表的数据量变小
	- 分库：增加数据库实例
		- 分散连接请求，锁冲突的概率降低
		- 突破单机数据库的连接数、CPU处理能力瓶颈
	- 分表：减小单表数据量
		- 提升查询速度：数据量越小，**索引树**的高度就越低
- 拆分方式：
	- **垂直拆分 (Vertical Sharding)**
	    - **垂直分库**：**按业务模块**将不同的表拆分到不同的数据库中。例如，将电商系统的用户表、订单表、商品表分别放入独立的数据库。这有助于降低单库容量和压力，并使业务边界更清晰
	    - **垂直分表**：**按字段活跃度**将一个宽表的字段拆分成主表和扩展表。例如，将商品详情等不常访问的大字段拆到扩展表，让主表能缓存更多热点数据（如商品ID、名称、价格），减少磁盘IO，提升查询效率
	- **水平拆分 (Horizontal Sharding)**
	    - **水平分库**：将**同一个表的数据**按一定规则（如用户ID取模）分散到多个数据库中。这主要用于解决单库的并发压力
	    - **水平分表**：将**同一个表的数据**按一定规则分散到同一个数据库的多个表中（如`order_001`, `order_002`）。这是解决单表数据量过大最常用的策略
- 问题：
	- **跨分片查询**：需要跨多个分表进行聚合查询（如`SUM`, `COUNT`）会变得复杂，通常需要在应用层合并结果或使用专门的中间件
	- **分片键选择**：分表所依据的字段（分片键）选择至关重要。若选择不当，可能导致**数据倾斜**，影响分表效果
	- **分布式事务**：涉及更新多个分表的事务，需要处理**分布式事务**以保障数据一致性，这比单表事务复杂
	- **维护复杂度**：需要管理更多的表，可能还需要借助分库分表中间件（如ShardingSphere、MyCAT）来简化操作
	- ​**全局主键唯一性**​：在多个数据库上，如何生成唯一、单调递增的ID？常用方案有雪花算法、UUID、号段模式等。
**实施建议**：
- **切勿过度设计**：在业务发展初期，不应过早进行分库分表。应优先考虑优化SQL、引入缓存、读写分离、升级硬件等手段。
- **选择合适的分片键(Sharding Key)**：分片键的选择至关重要，应尽量选择数据分布均匀且与核心查询条件相关的字段（如用户ID），以避免数据倾斜和复杂的跨分片查询
- **循序渐进**：优先考虑**垂直拆分**，因为它在业务层面更清晰，影响相对较小。当数据量和并发量进一步增长时，再考虑**水平拆分**
#### 
分库分表在应用层实现起来非常复杂，通常借助中间件。图片介绍了两种主流方案：

| 方案                   | 模式                | 优点                                    | 缺点                            | 适用场景                         |
| -------------------- | ----------------- | ------------------------------------- | ----------------------------- | ---------------------------- |
| ​**Sharding-JDBC​**​ | ​**客户端中间件**​      | ​**性能高**​（无代理层网络开销），与Java应用集成度高，功能强大。 | ​**代码侵入性强**，需在应用中配置，仅支持Java。  | 对性能要求极高的Java技术栈项目。           |
| ​**MyCat​**​         | ​**服务端中间件（代理）​**​ | ​**对应用透明**，无需修改代码，支持多种语言。​**易于管理**。   | ​**性能有损耗**​（多一层网络跳转），有单点瓶颈风险。 | 多语言技术栈、希望快速上线、对绝对性能要求不极致的场景。 |

    
## Mycat
![[Pasted image 20251104111114.png]]
### Mycat概述

### Mycat配置
### Mycat分片
### Mycat管理及监控