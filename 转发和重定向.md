### 转发和重定向的定义
在 Web 开发中，“转发”和“重定向”是两种核心的跳转机制，它们的核心区别在于对浏览器而言是**一次请求还是两次请求**。

| 特性         | 转发                                         | 重定向                       |
| ---------- | ------------------------------------------ | ------------------------- |
| **请求次数**   | 1 次                                        | 2 次                       |
| **URL 变化** | 地址栏不变化                                     | 地址栏变为新地址                  |
| **数据共享**   | 共享同一个 `request`对象                          | 不共享 `request`对象           |
| **跳转范围**   | 仅限当前应用内部                                   | 可以指向任何 URL（内外部均可）         |
| **速度**     | 较快（服务器内部完成）                                | 较慢（需要客户端二次请求）             |
| **实现方式**   | `request.getRequestDispatcher().forward()` | `response.sendRedirect()` |

#### 如何选择？

- **选择转发的情况**：适用于**当前应用内部**的跳转，并且需要在下个页面使用本次请求处理的数据时（例如，查询数据库结果后跳转到展示页面）。由于更快且能保持数据，是优先考虑的方式。
    
- **选择重定向的情况**：
    
    1. **跳转到其他网站或外部应用**。
        
    2. 避免**表单重复提交**。例如，在成功提交 POST 请求（如注册、付款）后使用重定向到成功页面，这样即使用户刷新浏览器，也只是刷新了重定向后的 GET 请求页面，而不会重复提交表单。
        
    3. 当需要**让用户的书签或链接是最终页面的地址**时。
        
    
####  转发：服务器内部高效协作

- **工作原理**：服务器在接收到请求后，在**内部**将当前的 `HttpServletRequest`和 `HttpServletResponse`对象“传递”给另一个资源（如另一个 Servlet 或 JSP 页面）进行处理。对于浏览器而言，它只发起了**一次请求**，并且地址栏的 URL **不会改变**。
    
- **技术实现**：在 Java Servlet 中，主要通过 `RequestDispatcher`对象实现。
    
    ```
    // 获取请求转发器，并指定要跳转到的路径
    RequestDispatcher dispatcher = request.getRequestDispatcher("/targetPage.jsp");
    // 开始转发，将当前的请求和响应对象传递过去
    dispatcher.forward(request, response);
    ```
    
- **核心特点**：
    
    - **一次请求，一次响应**：浏览器只发出一次请求，服务器内部完成跳转。
        
    - **地址栏不变**：浏览器感知不到跳转过程，地址栏显示的是最初请求的 URL。
        
    - **数据共享**：由于是同一个请求对象，转发的源和目标组件可以共享 `request`域中设置的属性（通过 `request.setAttribute()`和 `request.getAttribute()`）。
        
    - **只能跳转至本站点内资源**：无法通过转发将用户引导至另一个域名或外部网站。
        
    

#### 重定向：客户端的二次导航

- **工作原理**：当服务器接收到请求后，它会返回一个**特殊的 HTTP 状态码（通常是 302）** 和一个 **`Location`响应头**（其值就是新的 URL）。浏览器接收到这个响应后，会**自动**向 `Location`头中指定的新 URL 发起**第二次请求**。因此，地址栏的 URL **会更新**为新的地址。
    
- **技术实现**：主要通过 `HttpServletResponse`对象的 `sendRedirect`方法实现。
    
    ```
    // 发送重定向响应
    response.sendRedirect("https://example.com/newPage.jsp");
    // 或者站内跳转（需要包含应用上下文路径）
    response.sendRedirect(request.getContextPath() + "/newPage.jsp");
    ```
    
- **核心特点**：
    
    - **两次请求，两次响应**：浏览器会发出两次完全独立的 HTTP 请求。
        
    - **地址栏变化**：浏览器地址栏会显示最终重定向后的 URL。
        
    - **数据不共享**：两次请求拥有各自的 `request`和 `response`对象，因此不能直接通过 `request`域共享数据。需要借助 URL 参数、Session 等技术传递信息。
        
    - **可以跳转至任意 URL**：既可以指向本站点内的资源，也可以指向互联网上任何一个有效的网址。
        

## 转发和重定向的实现
| 操作       | 实现方式                                                         | 适用场景                                  |
| -------- | ------------------------------------------------------------ | ------------------------------------- |
| **转发**   | `return "view-name";`或 `return "forward:/url";`              | 渲染模板、应用内部跳转、保持请求数据                    |
| **重定向**  | `return "redirect:/url";`                                    | 防止重复提交、登录后跳转、PRG模式（Post-Redirect-Get） |
| **传递数据** | 使用 `Model`+ `@ModelAttribute`（转发）或 `RedirectAttributes`（重定向） | 在跳转过程中共享数据                            |

|特性|`Model`+ `@ModelAttribute`(用于转发)|`RedirectAttributes`(用于重定向)|
|---|---|---|
|**适用场景**|**转发（Forward）**|**重定向（Redirect）**|
|**数据传递原理**|同一请求内，通过 `request.setAttribute()`|1. **URL 拼接**(`addAttribute`)  <br>2. **Session 暂存**(`addFlashAttribute`)|
|**数据生命周期**|当前请求|1. **URL 参数**：一次请求  <br>2. **Flash 属性**：下次请求后自动清除|
|**安全性**|高（数据在服务器内部）|1. **URL 参数**：低（暴露在地址栏）  <br>2. **Flash 属性**：中（存储在Session）|
|**适用数据类型**|任何Java对象|1. **URL 参数**：简单字符串  <br>2. **Flash 属性**：任何Java对象|
### 转发的实现（Spring Boot）

#### 转发的传递数据的方式--[[Model对象]]


#### 转发的方式
##### 1. 转发到视图模板（最常用）

这是最常见的场景。假设你使用了 Thymeleaf 模板引擎。

**Controller 代码：**

```
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller // 注意：不是 @RestController
public class ViewController {

    @GetMapping("/greet")
    public String greet(@RequestParam String name, Model model) {
        // 将数据添加到模型，Thymeleaf 模板可以访问
        model.addAttribute("userName", name);
        // 返回逻辑视图名，视图解析器会自动映射到 src/main/resources/templates/greeting.html
        return "greeting"; // 默认就是转发
    }
}
```

**Thymeleaf 模板 (`src/main/resources/templates/greeting.html`):**

```
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Greeting</title>
</head>
<body>
    <h1>Hello, <span th:text="${userName}">User</span>!</h1>
    <!-- 其他 HTML 内容 -->
</body>
</html>
```

**访问结果：**

- 访问 `http://localhost:8080/greet?name=John`-> 浏览器显示 `Hello, John!`，地址栏**保持不变**。
    
- 访问 `http://localhost:8080/internal`-> 浏览器显示 `Hello, InternalUser!`，地址栏**保持不变**（仍显示 `/internal`）。
    

##### 2. 显式使用 `forward:`前缀

```
@Controller
public class MyController {
    @GetMapping("/old-url")
    public String forwardExample() {
        // 显式转发到另一个URL
        return "forward:/new-url";
    }

    @GetMapping("/new-url")
    @ResponseBody
    public String newUrl() {
        return "This is the new content";
    }
}
```

### 重定向的实现（Spring Boot）

重定向在 Spring Boot 中常用于**表单提交后防止重复提交**、**登录后跳转**等场景。

#### 重定向数据的传递--[[RedirectAttributes]]对象 
#### 重定向的方式

```
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class RedirectController {

    @GetMapping("/form")
    public String showForm() {
        return "user-form"; // 转发到表单页面
    }

    @PostMapping("/submitForm")
    public String submitForm(User user) {
        // 处理表单数据...
        userService.save(user);
        // 重定向到一个GET请求，防止刷新浏览器时重复提交POST请求
        return "redirect:/success";
    }

    @GetMapping("/success")
    public String success() {
        return "success-page"; // 成功页面
    }
}
```

**访问流程：**

1. GET `/form`-> 显示表单。
    
2. POST `/submitForm`-> 处理数据。
    
3. 服务器返回 **302 Redirect**到 `/success`。
    
4. 浏览器**自动发起新请求**：GET `/success`。
    
5. 显示成功页面，地址栏**更新为**`/success`。

##### 在 RESTful 控制器中的重定向

如果你的控制器是 `@RestController`，你通常返回的是 JSON 数据而不是视图名。但有时你可能需要重定向到另一个端点。

```
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.*;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

@RestController
@RequestMapping("/api")
public class ApiController {

    // 方法1：返回重定向的URL（由客户端处理）
    @PostMapping("/v1/users")
    public ApiResponse createUserV1(@RequestBody User user) {
        User savedUser = userService.save(user);
        // 让客户端自己发起重定向请求
        return new ApiResponse("/api/v1/users/" + savedUser.getId());
    }

    // 方法2：使用HttpServletResponse直接重定向（更直接）
    @PostMapping("/v2/users")
    public void createUserV2(@RequestBody User user, HttpServletResponse response) throws IOException {
        User savedUser = userService.save(user);
        response.sendRedirect("/api/v2/users/" + savedUser.getId());
    }
}

// 客户端处理的响应体
class ApiResponse {
    private String location;
    // 构造器、getter、setter...
}
```


