---
aliases:
  - 栈帧
---


- 栈内存的使用
	- 服务对象：线程
		- 每个线程有自己的栈内存
		- 栈内存之间互相独立
	- 分配时机：每个线程启动的时候，JVM就会为其分配一个栈空间
	- 分配的大小：大小固定
		- 设置每个线程的栈内存大小：`-Xss`
			- 影响在总内存有限的情况下，增加此值意味着可创建的线程总数会减
	- 组成成分：栈帧
		- 分配时机：每次方法调用时
			- 方法被调用时候，对应的栈帧压入栈顶，成为活动栈帧
				- 活动栈帧：每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法
			- 方法执行完毕，对应的栈帧被弹出，返回方法返回地址所指向的位置继续执行
		- 栈帧存储的内容：
			-  局部变量表：
				- 存放的范围：
					- 方法参数中带有的
					- 方法内部定义的
				- 存放的内容：
					- 基本类型变量
					- 对象引用。
			- 操作数栈：方法执行时，用于计算的临时工作区
			- 动态链接：指向 运行时 常量池中 该栈帧   所属方法 的引用。
			- 方法返回地址：存放方法返回后需要继续执行的字节码指令地址。
- 栈相关异常：
	1. `StackOverflowError`（栈内存溢出）：
		- 原因：
			- 栈帧过多
				- 线程的方法调用链过深（例如没有出口的递归），每次调用一个方法都增加栈帧
				- JSON转化器中待转化的类出现循环引用问题
			- 栈帧过大
	2. `OutOfMemoryError`：内存溢出
		原因：JVM没有足够的内存空间为一个新创建的线程分配其私有的栈内存时。
- [[线程运行诊断]]
	
