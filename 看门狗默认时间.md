---
aliases:
  - 锁续期机制
  - 看门狗自动续期
---

总结一下，当您 **不显式设置锁的租约时间（`leaseTime` ）** 时，就会用到看门狗的默认时间（设置一个定时任务，默认30秒超时，每10秒检查续期）。它特别适用于**业务执行时间不确定或希望简化代码**的场景。如果您需要对锁的超时行为进行更精确的控制，则应在加锁时明确指定 `leaseTime`。
![[Pasted image 20251119200625.png]]


| **触发条件**​    | 使用 `lock()`或 `tryLock()`方法时，**未显式指定**​ `leaseTime`（锁自动释放时间）参数 。 |
| ------------ | --------------------------------------------------------------- |
| **默认锁超时时间**​ | **30秒**。这是锁在Redis中的存活时间 。                                       |
| **默认续期间隔**​  | **10秒**。即看门狗每隔 `lockWatchdogTimeout / 3`的时间执行一次续期检查 。           |
| **续期操作**​    | 如果锁仍由当前客户端持有，看门狗会将其过期时间**重置为默认的30秒**​ 。                         |


### 触发条件详解
![[Pasted image 20251119201035.png]]
看门狗机制并非总是启用，它的激活有一个明确的规则：

- **启用看门狗**：当您调用类似 `lock.lock()`或 `lock.tryLock(10, TimeUnit.SECONDS)`（只指定等待时间，未指定租约时间）这样的方法时，Redisson 会发现您没有明确告知锁应该自动持有多久。此时，为了保证锁在业务执行期间不会意外过期，它会自动启动看门狗，并采用默认的30秒超时时间 。
    
- **禁用看门狗**：当您调用类似 `lock.lock(10, TimeUnit.SECONDS)`或 `boolean res = lock.tryLock(100, 10, TimeUnit.SECONDS)`这样的方法，并**显式指定了 `leaseTime`参数**时，Redisson 会认为您希望精确控制锁的生命周期。此时，看门狗机制将**不会启动**，锁在到达您设定的时间后会自动释放，无论业务是否执行完毕 。
    

###  典型使用场景

基于上述触发条件，在以下情况下您会自然而然地用到看门狗的默认时间：

1. **执行时间不确定的任务**：当您无法准确预估一段代码需要执行多久时，使用看门狗是最佳选择。例如，一个需要等待外部系统响应的任务，或者一个处理时间随数据量波动的批处理任务。看门狗能确保只要任务还在进行，锁就一直有效 。
    
2. **追求代码简洁性**：对于许多无需精细控制锁持有时间的场景，直接使用 `lock.lock()`是最简单的方式。您无需关心续期逻辑，看门狗在后台为您打理好一切，让代码更专注于业务本身 。
    
3. **默认配置满足需求**：在大多数并发场景下，30秒的默认超时时间和10秒的检查间隔已经足够应对网络延迟和一般的业务处理。如果您的业务平均执行时间远小于30秒，使用默认配置既安全又省心。
    

###  如何配置默认时间

如果您觉得30秒的默认值不适合您的业务，可以对其进行全局调整。这通常在创建Redisson客户端时进行配置 。

```
Config config = new Config();
config.useSingleServer().setAddress("redis://127.0.0.1:6379");
// 将看门狗的默认锁超时时间设置为 60 秒
config.setLockWatchdogTimeout(60 * 1000); 
RedissonClient redisson = Redisson.create(config);
```

完成此配置后，只要不显式指定 `leaseTime`，新启动的看门狗就会使用您设置的60秒作为续期周期。

### 简要回顾

