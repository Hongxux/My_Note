---
aliases:
  - STAB
---
- 触发时机：原本可达的对象变不可达
	- 在G1的并发标记阶段，灰色/黑色对象断开了对白色对象的引用，变成了垃圾。
- 设计理念：确保这些在快照中存活的对象不会被错误回收
	- 只要在G1标记阶段开始前的快照阶段是存活的，即使在并发标记阶段被删除了，我也让这个被删除的对象在本轮存活
- 策略：
	- 并发标记阶段，记录这个删除操作
		- 【记录】 写屏障会将被断开引用的旧值，记录到线程本地的SATB缓冲区
	- 最终标记阶段，扫描SATB缓冲区，将那些被“删除引用”的白色对象强行标记为黑色（或者变灰重新扫描）
- 问题：
	- 因为它忽略了并发过程中新产生的垃圾，认为开始时活的就是活的，导致浮动垃圾相对更多
- 好处：
	- 重新标记阶段更快
- G1选择的利用：
	- 不用CMS：深度扫描新增引用的对象，可能需要跨越多个Region，代价很高。
	- 重新标记阶段只需要处理少量的“删除记录”，效率更高