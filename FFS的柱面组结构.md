---
aliases:
  - 柱面组
---

### ​**FFS 的核心机制：柱面组**​

为了解决旧UNIX文件系统性能低下的问题，FFS迈出的第一步是重新设计磁盘上的数据结构。其核心思想是引入“磁盘感知”的组织形式。

#### ​**一、 核心设计：磁盘空间分组管理**​

FFS不再将整个磁盘视为一个连续、统一的空间，而是将其划分为多个称为**柱面组**​ 的集合。

- ​**设计示意图**​： 一个磁盘被划分为多个组，例如：`G0 G1 G2 G3 G4 G5 G6 G7 G8 G9`。
    
- ​**现代对应物**​： 在一些现代文件系统（如Linux ext2/ext3）中，相同的概念被称为**块组**。
    
- ​**核心目的**​： 这是FFS提升性能的**根本机制**。通过将可能被连续访问的文件和目录放置在**同一个柱面组**​ 内，FFS可以确保对这些数据的访问无需进行耗时的长距离磁盘寻道。
    

#### ​**二、 单个柱面组的内部结构**​

每个柱面组都包含一个完整的、小型的文件系统管理结构，其布局如下：

`[ S | ib | db | Inodes | Data ]`

各组成部分的功能如下：

1. ​**超级块**​
    
    - ​**位置与冗余**​： 每个柱面组都保存有一份**超级块的副本**。
        
    - ​**目的**​： 主要为了**提升可靠性**。如果某个组的超级块因磁盘损坏而无法读取，系统仍然可以使用其他组的副本来挂载和访问文件系统。
        
    
2. ​**位图**​
    
    - ​**类型与功能**​：
        
        - ​**inode位图**​： 用于追踪该组内每个inode是空闲还是已被使用。
            
        - ​**数据位图**​： 用于追踪该组内每个数据块是空闲还是已被使用。
            
        
    - ​**优势**​： 与旧式文件系统使用的**空闲链表**​ 相比，位图是更优秀的空闲空间管理方式。它能更高效地找到并分配**连续的大块空闲空间**​ 给文件，这有助于从源头上**避免或减轻旧系统严重的碎片化问题**。
        
    
3. ​**inode区域与数据块区域**​
    
    - ​**功能**​： 与旧式文件系统类似，分别用于存储文件的元数据（inode）和文件内容本身（数据块）。
        
    - ​**容量**​： 数据块区域依然占据了每个柱面组中的绝大部分空间。
        
    

---

​**逻辑层次总结**​：

- ​**顶层设计**​： 将磁盘从“整体”改为“分组”（柱面组），以实现数据局部性。
    
- ​**组内结构**​： 每个组自成体系，包含管理所需的全套元数据（超级块、位图）和用户数据（inode、数据块）。
    
- ​**组件功能**​：
    
    - ​**冗余超级块**​ → 解决**可靠性**问题。
        
    - ​**位图**​ → 解决**空间分配效率**和**碎片化**问题。
        
    - ​**inode与数据块就近分布**​ → 为后续的分配策略奠定基础，直接解决**性能**问题。
        
    

这个经过精心设计的柱面组结构，为FFS实施智能的数据分配策略（即将相关数据放置在相同组内）提供了物理基础，从而实现了性能的飞跃。