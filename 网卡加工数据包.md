根据文档内容（主要基于第2章“用电信号传输TCP/IP数据”），网卡（Network Interface Card，NIC）在发送网络包时，会执行一系列加工操作，将协议栈传递的数字信息转换为适合物理传输的电信号或光信号。这些加工步骤包括添加控制信息、错误检测机制，以及处理信号传输的物理层细节。以下是网卡对发送包进行加工的详细过程，结构分为几个关键步骤，以丰富内容组织。每个步骤均严格依据文档描述，并在相关位置嵌入原始图片（图片标签来自文档，确保紧邻其原始描述）。

### 1. ​**接收协议栈数据并内部缓冲**​

- 协议栈（IP模块）将待发送的网络包传递给网卡驱动程序。网卡驱动程序会将包数据复制到网卡内部的缓冲区中。这一步是加工的前置操作，确保数据暂存并准备好后续处理。
    
- 网卡内部结构包括发送电路和接收电路（如文档图2.23所示）。发送电路负责后续加工，而网卡的PHY（物理层收发器）或MAU（介质访问单元）模块是核心组件，负责信号转换。
    

![](https://hunyuan-plugin-private-1258344706.cos.ap-nanjing.myqcloud.com/pdf_youtu/img/hy-20250915165041_6892aa1b802cd063acf227c4a1cfe9f2-142-1.png?q-sign-algorithm=sha1&q-ak=AKID372nLgqocp7HZjfQzNcyGOMTN3Xp6FEA&q-sign-time=1758074335%3B2073434335&q-key-time=1758074335%3B2073434335&q-header-list=host&q-url-param-list=&q-signature=19c496ac28b379e7d6f8e39d58a54503812ab98d)

- ​**关键细节**​：网卡的ROM中存储了唯一的MAC地址，驱动程序在初始化时会读取并设置MAC模块（文档2.5.7节）。网卡不关心包内容（如TCP头部或应用数据），只专注于物理层加工。
    

### 2. ​**添加报头（Preamble）​**​

- 网卡的**MAC模块**从缓冲区中取出包数据，并在包开头添加一个56比特的报头。报头由101010...的比特序列组成（交替的1和0），用于同步接收方的时钟。例如，在以太网中，报头帮助接收设备确定读取数据的时机，避免信号传输中的时钟偏移。
    
- ​**功能作用**​：报头通过固定波形（如文档图2.25所示）确保接收方能准确检测信号起始点。这是因为实际信号在网线中传输时会衰减和失真（如拐角变圆），报头提供基准参考。
    

![](https://hunyuan-plugin-private-1258344706.cos.ap-nanjing.myqcloud.com/pdf_youtu/img/hy-20250915165041_6892aa1b802cd063acf227c4a1cfe9f2-144-5.png?q-sign-algorithm=sha1&q-ak=AKID372nLgqocp7HZjfQzNcyGOMTN3Xp6FEA&q-sign-time=1758074347%3B2073434347&q-key-time=1758074347%3B2073434347&q-header-list=host&q-url-param-list=&q-signature=e17eff3fad1e53dfcf5cc89635481845172506a1)

- ​**关键细节**​：报头添加是网卡加工的核心步骤之一，它不改变包的数据内容，仅作为物理层控制信息（文档2.5.8节）。添加后，包长度增加，但网卡会根据线路类型（如以太网）优化波形。
    

### 3. ​**添加起始帧分界符（Start Frame Delimiter, SFD）​**​

- 紧接报头之后，网卡添加起始帧分界符（SFD）。SFD是一个8比特的特殊序列（如10101011），用于明确标识帧的开始位置。接收方检测到SFD后，会从该点开始提取有效数据。
    
- ​**功能作用**​：SFD防止信号传输中的歧义。例如，在网线噪声环境下，SFD帮助区分报头的时钟同步部分和实际数据部分（如文档图2.25所示）。它与报头结合，确保包的完整性。
    

![](https://hunyuan-plugin-private-1258344706.cos.ap-nanjing.myqcloud.com/pdf_youtu/img/hy-20250915165041_6892aa1b802cd063acf227c4a1cfe9f2-144-5.png?q-sign-algorithm=sha1&q-ak=AKID372nLgqocp7HZjfQzNcyGOMTN3Xp6FEA&q-sign-time=1758074358%3B2073434358&q-key-time=1758074358%3B2073434358&q-header-list=host&q-url-param-list=&q-signature=cec8ee33fc7cd2299cb8174dbd5eb2ac69ff4322)

- ​**关键细节**​：SFD的波形设计考虑了信号衰减（如文档图3.3）。网卡通过PHY模块将数字SFD转换为物理信号，以适应不同网线类型（如双绞线）。
    

### 4. ​**添加帧校验序列（Frame Check Sequence, FCS）​**​

- 在包的末尾，网卡添加一个32比特的帧校验序列（FCS）。FCS是通过算法（如CRC）计算整个包内容（包括报头、SFD和数据）得出的校验值，用于检测传输中的错误（如噪声干扰导致的比特翻转）。
    
- ​**功能作用**​：FCS允许接收方验证包完整性。如果传输中信号失真（如文档图3.3所示），接收方计算FCS与发送方值不匹配，则丢弃包。这避免了错误数据传播，但网卡不重发包（重传由协议栈TCP模块处理）。
    
- ​**关键细节**​：FCS添加后，网卡完成包的封装（如文档图2.24所示）。包结构变为：报头 + SFD + 原始包（含MAC头部、IP头部和数据） + FCS。这一步是错误检测的关键，但网卡不修复错误，仅提供校验机制。
    

![](https://hunyuan-plugin-private-1258344706.cos.ap-nanjing.myqcloud.com/pdf_youtu/img/hy-20250915165041_6892aa1b802cd063acf227c4a1cfe9f2-144-1.png?q-sign-algorithm=sha1&q-ak=AKID372nLgqocp7HZjfQzNcyGOMTN3Xp6FEA&q-sign-time=1758074370%3B2073434370&q-key-time=1758074370%3B2073434370&q-header-list=host&q-url-param-list=&q-signature=18bb649d4da8010b1f5df4f1d9eb10dc302029cb)

- ​**FCS计算示例**​：网卡使用公式生成校验码，类似磁盘CRC机制（文档2.5.8节）。添加FCS后，包长度固定增加，网卡根据线路MTU（最大传输单元）确保包不超限。
    

### 5. ​**转换为电信号并执行发送操作**​

- 网卡将加工后的包（含报头、SFD、FCS）转换为电信号或光信号。此过程由**PHY/MAU模块**执行，包括信号调制（如将数字比特映射为电压变化）和物理发送。
    
- ​**发送操作细节**​：
    
    - ​**半双工模式**​：网卡检查线路空闲（无其他信号），如果检测到碰撞（collision），则发送阻塞信号并等待重试（文档2.5.9节）。
        
    - ​**全双工模式**​：无需碰撞检测，直接发送（如文档图2.10所示）。
        
    
- ​**关键细节**​：网卡根据时钟信号控制发送时序（如文档图2.26所示），确保信号波形准确。例如，电信号通过网线接口（如RJ-45）传输，最终流向集线器或交换机。
    

![](https://hunyuan-plugin-private-1258344706.cos.ap-nanjing.myqcloud.com/pdf_youtu/img/hy-20250915165041_6892aa1b802cd063acf227c4a1cfe9f2-145-2.png?q-sign-algorithm=sha1&q-ak=AKID372nLgqocp7HZjfQzNcyGOMTN3Xp6FEA&q-sign-time=1758074382%3B2073434382&q-key-time=1758074382%3B2073434382&q-header-list=host&q-url-param-list=&q-signature=82cc0bb6a5be10fb230d169d471f7f6be62dcb89)

- ​**信号转换示例**​：网卡输出波形可能如图2.27所示（针对100BASE-TX），但文档未提供具体标签，因此不嵌入。发送后，网卡不保证送达（可靠性由上层协议处理）。
    

### 总结

网卡对发送包的加工主要包括：添加报头（同步时钟）、起始帧分界符（标识帧起始）、帧校验序列（错误检测），以及最终转换为物理信号。这些操作均在物理层完成，确保数字包适配网线传输，但网卡不修改包内容（如IP或TCP头部）。整个过程高效且标准化，支持以太网等通信技术（文档2.5节）。加工后的包通过网线传输，由集线器或交换机进一步处理（文档第3章）。网卡的加工是网络通信的基础，但**仅处理信号层面**，错误恢复和重传由**协议栈**负责。