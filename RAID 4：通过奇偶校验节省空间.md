---
aliases:
  - RAID 4
---
![[Pasted image 20251009191414.png]] a
### ​**RAID 级别详解：RAID 4（专用奇偶校验）​**​

RAID 4 通过引入奇偶校验信息来提供冗余，旨在以比镜像更低的容量开销实现数据保护。

#### ​**一、 核心原理：块级条带化与专用奇偶校验盘**​

1. ​**基本机制**​
    
    - ​**数据分布**​：数据以块为单位条带化分布在多个数据磁盘上，与RAID 0类似。
        
    - ​**冗余机制**​：为每个条带（一组横向的数据块）计算一个**奇偶校验块**，并将其存储在一个**专用的校验磁盘**上。
        
    - ​**示例**​：在一个5磁盘的RAID 4阵列（4个数据盘，1个校验盘）中，条带0包含数据块0,1,2,3，其校验块P0存储在磁盘4上。
        
    
2. ​**奇偶校验的计算与重建**​
    
    - ​**计算函数**​：使用**异或**​ 操作。XOR的特性是：一组数据位经过XOR运算后，如果其中任何一位丢失，可以通过将剩余位与校验位再次进行XOR运算来重建丢失的位。
        
    - ​**块级计算**​：对数据块的每一位进行独立的位XOR运算，生成校验块中对应的位。
        
    - ​**重建过程**​：当一块数据盘故障时，故障盘上的每个数据块都可以通过读取同一条带内其他所有数据块和校验块并进行XOR运算来重建。
        
    
3. ​**写操作与“小写问题”​**​
    
    - ​**全条带写入**​：当写入一个完整条带的所有数据时，可以并行写入所有数据盘和校验盘，效率最高。性能接近 `(N-1) · S`。
        
    - ​**部分条带写入（小写问题）​**​：当只更新一个条带中的部分数据块时，问题变得复杂。为了更新校验块，需要：
        
        - ​**方法一（加法校验计算）​**​：读取同条带内**所有未更改的数据块**，与**新数据块**进行XOR计算新校验值。这种方法在磁盘数量多时I/O开销大。
            
        - ​**方法二（减法校验计算）​**​：这是更高效的方法，仅需：
            
            1. 读取**旧数据块**。
                
            2. 读取**旧校验块**。
                
            3. 计算新校验值：`P(new) = (C(old) XOR C(new)) XOR P(old)`。
                
                无论哪种方法，一次逻辑写操作最终都需要**两次读取**和**两次写入**。
                
            
        
    - ​**性能瓶颈**​：所有的小写操作都必须更新**同一个专用校验盘**。这导致校验盘成为严重的瓶颈，使得随机写性能无法随着磁盘数量的增加而提升。
        
    

#### ​**二、 三维评估**​

1. ​**容量**​
    
    - ​**评估结果**​：效率较高。
        
    - ​**分析**​：无论阵列中有多少磁盘，仅使用**一个磁盘的容量**来存储校验信息。因此，有用容量为 ​**N-1**，空间利用率远高于RAID 1（例如，5盘阵列中利用率为80%）。
        
    
2. ​**可靠性**​
    
    - ​**评估结果**​：良好，但有限。
        
    - ​**分析**​：可以**容忍任意一块磁盘的故障**​（数据盘或校验盘）。通过校验信息重建故障盘数据。但**无法容忍两块或以上磁盘同时故障**。
        
    
3. ​**性能**​
    
    - ​**单次请求延迟**​：
        
        - ​**读延迟**​：与单磁盘相同（假设读请求落在数据盘上）。
            
        - ​**写延迟**​：远高于单磁盘。由于小写操作需要“两读两写”，其延迟大约是单磁盘写入的两倍。
            
        
    - ​**稳态吞吐量**​：
        
        - ​**顺序读吞吐量**​：​**​（N-1）· S**。可以并行从所有数据盘读取，校验盘不参与。
            
        - ​**顺序写吞吐量**​：​**​（N-1）· S**。在理想的全条带写入情况下，所有磁盘（包括校验盘）并行工作，有效带宽取决于数据盘的数量。
            
        - ​**随机读吞吐量**​：​**​（N-1）· R**。请求被分布到所有数据盘上，性能接近RAID 0。
            
        - ​**随机写吞吐量**​：​**极差，约为 R/2**。这是RAID 4的**致命弱点**。由于所有写操作都必须串行访问专用的校验盘，随机写吞吐量被限制在**单块校验盘的I/O能力内**，并且不会随着磁盘数量增加而扩展。
            
        
    

#### ​**三、 总结**​

RAID 4 在**容量效率**上取得了巨大进步，以仅损失一个磁盘的代价实现了单盘故障容错。其**读取性能**​（顺序和随机）表现良好。然而，​**专用校验盘**的设计导致了著名的**​“小写问题”​**，使得其**随机写入性能**成为主要瓶颈，无法扩展。这使得RAID 4在实际应用中较少被直接使用，进而催生了RAID 5。

---

​**逻辑演进提示**​：RAID 4 的“小写问题”根源在于校验盘集中化。解决方案就是将校验块也条带化分布到所有磁盘上，从而消除单一瓶颈。这就是 ​**RAID 5**​ 的核心思想。如果您提供关于RAID 5的内容，我将完成这部分的整理，并可以生成一份完整的RAID级别对比总结。