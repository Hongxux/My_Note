![[Pasted image 20251125133142.png]]
![[Pasted image 20251125133150.png]]

```
 
@Configuration  
public class RedisCachePreHandler implements InitializingBean {  
    @Autowired  
    private IShopService shopService;  
    @Autowired  
    private RedisCacheUtils redisCacheUtils;  
    @Autowired  
    private RedissonClient redissonClient;  
    @Override  
    public void afterPropertiesSet() throws Exception { 
	    //使用 分布式锁，确保多个服务实例的时候只有一个服务实例在预热
        RLock lock = redissonClient.getLock("CachePreHandler"); 
        boolean flag = lock.tryLock();  
        if(flag){  
  
            try {  
                //缓存预热  
                //1.查询商户信息  
                shopService.list().forEach(item->{  
                            //2.放入缓存  
                            redisCacheUtils.putCache(RedisConstants.CACHE_SHOP_KEY, item.getId(),item,30L, TimeUnit.MINUTES);  
                        }  
                );  
//        voucherService.list().forEach(item->{  
//                    //2.放入缓存  
//                    redisCacheUtils.putCache(RedisConstants.CACHE_SECKILL_VOUCHER_KEY, item.getId(),item,30L, TimeUnit.MINUTES);  
//                }  
//        );  
            } catch (Exception e) {  
                throw new RuntimeException(e);  
            } finally {  
                lock.unlock();  
            }  
        }  
  
          
  
    }  
}
```

```
//redisCacheUtils
public void set(String key, Object data, Long expireTime, TimeUnit timeUnit){  
    stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(data), expireTime, timeUnit);  
     
}
public<ID> void putCache(String preKey,ID id,Object data,Long expireTime, TimeUnit timeUnit){  
    String jsonData = String.valueOf(JSONUtil.parseObj(data));  
    set(preKey+id,jsonData,expireTime,timeUnit);  
}
```


![[Pasted image 20251125134924.png]]