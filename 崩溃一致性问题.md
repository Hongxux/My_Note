
- 问题根源：原子性更新的缺失
	- 一个看似简单的逻辑操作（如**向文件追加一个数据块**）需要更新磁盘上多个不同的、分散的数据结构。在这个例子中，需要更新三个块：
		1. ​**数据块（Db）​**​： 新写入的文件内容。
		2. ​**索引节点（I[v2]）​**​： 需要更新大小信息并指向新的数据块。
		3. ​**数据位图（B[v2]）​**​： 需要标记新数据块为已分配。
	- 磁盘硬件保证的是对**单个扇区**的写入是原子的，但无法保证这**三个独立的写入**作为一个整体（原子事务）完成。系统崩溃可能发生在三次写入之间的任意时刻。
- 崩溃后导致的不一致状态：
	- ​**元数据不一致**​： 这是最常见的问题。例如：
	    - 仅写入 ​**inode**​ 和 ​**数据**，但未更新**位图**​： inode指向有效数据，但位图显示该块空闲，导致数据结构冲突。
	    - 仅写入 ​**位图**​ 和 ​**数据**，但未更新**inode**​： 数据已写入，空间已被标记占用，但没有任何文件引用此数据块，导致**空间泄露**。
	- ​**指向垃圾数据**​： 这是更危险的问题。例如：
	    - 仅写入 ​**inode**​ 和 ​**位图**，但未写入**数据**​： 文件系统元数据看起来**完全一致**，但inode指向的数据块（Db）中仍是旧数据（垃圾）。文件系统检查器（fsck）无法发现此问题，导致用户读取到错误数据。
	    - 仅写入 ​**inode**​： inode指向了一个尚未被新数据覆盖的旧数据块，同样会读取到垃圾数据。
	- ​**写入丢失**​： 这是最轻微的情况。
	    - 仅写入 ​**数据块（Db）​**​： 数据在磁盘上，但元数据无法追踪它，相当于写入从未发生。
- 解决方案：
	1. ​**文件系统检查器（FSCK）​**​： 一种“事后修复”的被动方案，通过扫描整个文件系统来检测和修复不一致性，但效率低下。
	2. ​**日志技术（Journaling）​**​： 一种“事前预防”的主动方案，通过预写日志来确保在任何情况下都能快速恢复到一致状态，是现代文件系统的标准解决方案。