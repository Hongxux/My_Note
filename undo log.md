它记录了数据变化的历史，使得数据库能够“回到过去”（回滚）或为不同用户“展示不同的历史版本”（MVCC），从而实现了数据的一致性和高并发访问。
#### 一、Undo Log 是什么？

图中开宗明义地指出：

> ​**回滚日志，用于记录数据被修改前的信息。​**​

您可以将其理解为一个**数据库的“后悔药”或“操作记录备份”​**。每当要修改数据时，会先把数据修改前的状态记录下来。这样，如果事务需要回滚或取消，就可以根据这份记录将数据恢复到原来的样子。

#### 二、Undo Log 的两大核心作用

图中明确指出了 Undo Log 的两个关键使命：

1. ​**提供回滚，保证原子性**​
    
    - ​**原子性定义**​：一个事务中的所有操作，要么全部完成，要么全部不完成。
        
    - ​**如何实现**​：当事务执行 `ROLLBACK`时，InnoDB 会根据 Undo Log 中记录的逻辑，执行相反的操作来恢复数据。
        
        - 对于 `INSERT`，回滚时会执行相应的 `DELETE`。
            
        - 对于 `DELETE`，回滚时会执行相应的 `INSERT`。
            
        - 对于 `UPDATE`，回滚时会执行一个相反的 `UPDATE`，将数据改回旧值。
            
        
    
2. ​**实现多版本并发控制**​
    
    - ​**MVCC 定义**​：使数据库能够提供非阻塞读的一种技术。不同的事务可以看到数据在不同时间点的快照。
        
    - ​**如何实现**​：当某个事务需要读取数据，但该数据正在被另一个未提交的事务修改时，InnoDB 会通过 Undo Log 链**构建该行数据的旧版本快照**，提供给当前读取事务。这样就实现了读操作不会被写操作阻塞，极大提升了并发性能。
        
    

#### 三、Undo Log 的本质：逻辑日志

图中特别强调了一个关键区别：

> ​**undo log 和 redo log 记录物理日志不一样，它是逻辑日志。​**​

这是理解 Undo Log 的核心：

|日志类型|记录内容|类比|
|---|---|---|
|​**Redo Log**​|​**物理日志**，记录的是“在某个数据页的某个偏移量处，将值 `abc`改为 `def`”。|像硬盘的**扇区读写**，记录的是最底层的物理变化。|
|​**Undo Log**​|​**逻辑日志**，记录的是“执行了一个 `INSERT`操作，插入的值是 `...`”。|像软件的 ​**`Ctrl+Z`撤销操作记录**，记录的是高层的业务逻辑。|

​**示例说明（如图中所述）：​**​

- 当执行 `DELETE FROM users WHERE id = 1;`时，Undo Log 会记录一条等价的 `INSERT`语句逻辑。
    
- 当执行 `UPDATE users SET name = 'Lee' WHERE id = 1;`（原名为 `Wang`）时，Undo Log 会记录一条等价的 `UPDATE users SET name = 'Wang' WHERE id = 1;`语句逻辑。
    

#### 四、Undo Log 的生命周期与存储

##### 1. 产生与销毁

- ​**产生**​：在事务**执行**数据修改操作（DML）时产生。
    
- ​**销毁**​：​**事务提交时，并不会立即删除 undo log**。
    
    - ​**原因**​：这些日志可能还被其他正在运行的事务用于 ​**MVCC**，以读取数据的一致性快照。Undo Log 的清理是在确定没有任何事务再需要它之后，由后台 ​**Purge 线程**异步完成的。
		- 具体来说：系统会维护一个"最早活跃事务ID"，所有事务ID小于这个值的Undo Log都可以被安全清理
    

##### 2. 存储方式

- ​**管理单元**​：Undo Log 采用**段**​ 的方式进行管理。
    
- ​**存储位置**​：存放在**回滚段**​ 中。一个回滚段中包含多个 ​**Undo Log Segment**。
    

##### 3.[[undo log的版本链]]