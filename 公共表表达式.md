---
aliases:
  - CTE
  - WITH
---
- 需求背景：
	- 解决子查询的问题
		- 嵌套子查询的可读性低：多层嵌套的子查询使SQL语句变得冗长且难以理解
		- 子查询无法重复使用：同一子查询逻辑在语句中多次出现时，需要重复编写，导致代码冗余
	- 查询树形结构困难：
		- 查询树形结构通常需要依赖低效的游标或复杂的多次查询
- 解决措施：公共表
	- 将每个子查询提取出来并且命令
	- 之后在主查询中将它们连接使用
- 注意：
	- 不具有持久性：一旦查询结束，CTE就会消失
		- CTE仅在**定义它的单条查询执行期间有效**。它不会被持久化存储，
	- 公共表的作用域在定义之后，定义之前无法使用
	- 无法带来性能上的提高
- 语法：
	- 非递归：
		- 组成：
			- 公共表
			- 主查询语句
		```sql
		WITH cte_name (column1, column2, ...) AS (
		    -- 定义临时结果集的查询语句
		    SELECT ...
		)
		-- 主查询，在此使用上面定义的 cte_name
		SELECT ... FROM cte_name ...
		```
	- 递归查询：处理具有层次结构或树状关系的数据
	