

# 方式一

### 1. 查看/设置事务提交方式

```
-- 查看当前事务自动提交状态（1为自动提交，0为手动提交）
SELECT @@autocommit;

-- 设置事务提交方式（0=手动提交，1=自动提交）
SET @@autocommit = 0;
```

### 2. 提交事务

```
-- 手动提交当前事务，使所有更改永久生效
COMMIT;
```

### 3. 回滚事务

```
-- 撤销当前事务中的所有操作，恢复到事务开始前的状态
ROLLBACK;
```

## 完整的事务控制流程示例

```
-- 1. 查看当前自动提交状态
SELECT @@autocommit;

-- 2. 设置为手动提交模式
SET @@autocommit = 0;

-- 3. 开始事务（MySQL中START TRANSACTION可省略，但建议显式声明）
START TRANSACTION;

-- 4. 执行一系列数据库操作
UPDATE accounts SET balance = balance - 1000 WHERE id = 1;  -- 扣款
UPDATE accounts SET balance = balance + 1000 WHERE id = 2;  -- 存款

-- 5. 根据业务逻辑决定提交或回滚
-- 情况一：所有操作成功，提交事务
COMMIT;

-- 情况二：遇到错误或异常，回滚事务
ROLLBACK;

-- 6. 恢复自动提交模式（可选）
SET @@autocommit = 1;
```

## 关键注意事项

- ​**自动提交模式**​：MySQL默认autocommit=1，每条SQL语句自动作为独立事务提交
    
- ​**手动提交模式**​：设置autocommit=0后，需要显式执行COMMIT才能使更改永久生效
    
- ​**事务边界**​：使用START TRANSACTION明确开始事务，避免隐式事务的不可预测性
    
- ​**连接会话级**​：autocommit设置仅影响当前数据库连接，新连接会恢复默认设置
    
- ​**错误处理**​：在应用程序中应妥善处理异常，确保在出错时执行ROLLBACK
    

这些事务控制命令是保证数据库操作原子性和数据一致性的基础工具。
# 方式二

### ​**1. 开启事务**​

通过 `START TRANSACTION`或 `BEGIN`语句显式启动一个事务。这一步标志着一个新事务的开始，后续的所有数据库操作（如INSERT、UPDATE、DELETE）都会暂时保存在事务日志中，而不是立即永久生效。例如，在银行转账场景中，开启事务后，扣款和存款操作会进入待定状态。

### ​**2. 提交事务**​

使用 `COMMIT`语句确认事务中的所有操作。如果所有操作均成功执行，提交事务会使更改永久保存到数据库中。例如，转账的扣款和存款操作均无误后，执行 `COMMIT`使账户余额更新生效。

### ​**3. 回滚事务**​

通过 `ROLLBACK`语句撤销事务中的所有操作。如果在事务执行过程中出现错误（如余额不足、系统故障），回滚会取消所有未提交的更改，将数据恢复到事务开始前的状态。例如，转账时若扣款成功但存款失败，则执行 `ROLLBACK`使账户余额恢复原状。

### ​**完整示例（银行转账）​**​

```
-- 开启事务
START TRANSACTION;

-- 执行操作：从张三账户扣款1000元
UPDATE accounts SET balance = balance - 1000 WHERE name = '张三';

-- 执行操作：向李四账户存款1000元
UPDATE accounts SET balance = balance + 1000 WHERE name = '李四';

-- 检查业务逻辑（如余额是否充足）
-- 若一切正常，提交事务
COMMIT;

-- 若出现异常，回滚事务
ROLLBACK;
```

### ​**关键注意事项**​

- MySQL默认启用自动提交模式（autocommit=1），每条SQL语句单独作为事务处理。显式使用事务时，需通过 `SET autocommit=0`关闭自动提交。
    
- 事务必须遵循ACID特性（原子性、一致性、隔离性、持久性），确保数据操作的安全可靠。
    
- 在生产环境中，事务常与异常处理机制结合（如存储过程或应用程序代码），以动态决定提交或回滚。
    

通过合理使用事务操作，可以有效管理复杂业务逻辑中的数据一致性，避免部分操作失败导致的数据混乱。