存储过程是**一组为了完成特定功能的预编译SQL语句集合**，它被创建并存储在**数据库服务器**中。


> "存储过程思想上很简单，就是数据库SQL语言层面的代码封装与重用。"

这就像在编程中编写一个函数：

- ​**封装**​：将一系列复杂的数据库操作步骤打包成一个独立的单元。
    
- ​**重用**​：任何获得授权的应用程序或用户都可以多次调用这个单元，无需重复编写相同的代码逻辑。这保证了业务逻辑的一致性、安全性和可维护性。


**意义：**
1. ​**简化应用开发**​
    
    - ​**原理**​：将复杂的业务逻辑（涉及多个SQL操作）封装在数据库端的一个存储过程中。
        
    - ​**效果**​：应用程序开发者无需在代码中编写冗长的、分散的SQL语句，只需简单**调用存储过程的名称**并传递参数即可。这降低了应用程序代码的复杂性，也减少了出错的概率。
        
    
2. ​**减少数据传输，提升网络性能**​
    
    - ​**原理**​：应用程序无需将大量数据发送到数据库进行处理，也无需接收大量原始结果。只需发送一个存储过程调用指令和几个参数，然后接收处理后的最终结果。
        
    - ​**效果**​：​**极大减少了数据库与应用服务器之间的网络传输量**，特别适合处理数据量大的操作。
        
    
3. ​**提高处理效率**​
    
    - ​**预编译优势**​：存储过程在**创建时就已经进行了语法检查和编译**，并生成了优化的执行计划。每次调用时无需再次编译，直接执行，速度更快。
        
    - ​**减少开销**​：减少了SQL语句的解析、编译和优化开销。
        

### 一、创建存储过程

图中的语法明确指出了创建存储过程的标准格式：

```
CREATE PROCEDURE 存储过程名称([参数列表])
BEGIN
    -- 需要封装的一系列 SQL 语句
END;
```

​**关键组成部分解析：​**​

1. ​**`CREATE PROCEDURE`**​：
    
    - 这是定义存储过程的**固定关键字**，告诉数据库“我要创建一个新的存储过程”。
        
    
2. ​**`存储过程名称`**​：
    
    - 为你创建的存储过程取一个名字，以便后续调用。建议使用具有描述性的名称，如 `GetUserById`或 `UpdateOrderStatus`。
        
    
3. ​**`[参数列表]`**​：
    
    - 这是**可选的**。存储过程可以接受输入参数，使其更加灵活。
        
    - 参数格式通常为：`IN 参数名 参数数据类型`。例如：`(IN user_id INT)`。
        
    - `IN`表示该参数是输入参数（最常用），此外还有 `OUT`（输出参数）和 `INOUT`（输入输出参数）。
        
    
4. ​**`BEGIN ... END;`**​：
    
    - 这是存储过程的**主体部分**，所有要封装的业务逻辑和 SQL 语句都写在这对关键字之间。
        
    - 它可以包含简单的查询，也可以是复杂的逻辑控制（如 `IF`条件判断、`WHILE`循环等）。
        
#### 命令行中默认结束符的冲突
1. ​**MySQL 的默认设置**​：在 MySQL 命令行客户端中，​**分号 `;`被默认定义为 SQL 语句的结束符**。当客户端遇到 `;`时，它会认为一条 SQL 语句已经结束，并立即将其发送到服务器执行。
    
2. ​**存储过程的语法需求**​：存储过程的定义（`CREATE PROCEDURE`）其内部包含的**过程体（BEGIN ... END 块）​**​ 通常由多条独立的 SQL 语句组成，每条语句都需要用分号 `;`来结束。
    
3. ​**冲突发生**​：如果在命令行中直接编写包含内部分号的存储过程创建语句，MySQL 客户端会在遇到第一个内部分号时就误以为语句结束并执行，从而导致语法错误。
解决方法：`DELIMITER`关键字
```sql
-- 1. 改变结束符，避免过程体内的分号;导致提前执行
DELIMITER $$

-- 2. 定义存储过程。整个过程体是一个字符串，直到遇到$$才结束
CREATE PROCEDURE GetActiveUsers()
BEGIN
    -- 过程体内的多条SQL语句，用分号;正常结束
    SELECT COUNT(*) INTO @user_count FROM users WHERE status = 'active';
    SELECT * FROM users WHERE status = 'active' LIMIT 10;
END$$ -- 在这里，整个CREATE PROCEDURE语句才真正结束

-- 3. 将结束符改回默认的分号，以便后续操作
DELIMITER ;

-- 4. 现在可以正常使用分号调用存储过程了
CALL GetActiveUsers();
```

#### 过程体（BEGIN...END 块）

过程体是存储过程的核心逻辑部分，可以包含：

##### 1 变量声明


```
DECLARE variable_name datatype [DEFAULT value];
```

```
BEGIN
    DECLARE user_count INT DEFAULT 0;
    DECLARE user_name VARCHAR(50);
    DECLARE created_date DATE;
END
```

##### 2.流程控制语句

​**条件判断（IF-THEN-ELSE）​**​：

=

```
IF condition THEN
    statements;
ELSEIF condition THEN
    statements;
ELSE
    statements;
END IF;
```

​**循环语句**​：


```
-- WHILE 循环
WHILE condition DO
    statements;
END WHILE;

-- REPEAT 循环（至少执行一次）
REPEAT
    statements;
UNTIL condition
END REPEAT;

-- LOOP 循环（需要手动退出）
loop_label: LOOP
    IF condition THEN
        LEAVE loop_label; -- 退出循环
    END IF;
END LOOP;
```


### 二、调用存储过程

创建存储过程后，使用图中的简单语法来执行它：

```
CALL 存储过程名称([参数]);
```

- ​**`CALL`**​：是调用存储过程的**专用命令**。
    
- 只需指定存储过程的名称，并传入所需的实际参数值即可。
    



### 三、查询存储过程
#### 1查询数据库中的所有存储过程

```
SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA = 'xxx';
```

​**各项含义解读：​**​

- ​**`INFORMATION_SCHEMA.ROUTINES`**​：MySQL系统数据库中的元数据表，存储所有存储过程和函数的定义信息
    
- ​**`ROUTINE_SCHEMA`**​：字段名，表示存储过程所属的数据库名称
    
- ​**`'xxx'`**​：具体的数据库名占位符，需要替换为实际数据库名
    
- ​**返回信息**​：包含存储过程名称、类型、定义语句、创建时间等完整元数据
    

#### 2 查看特定存储过程定义

```
SHOW CREATE PROCEDURE 存储过程名称;
```

​**各项含义解读：​**​

- ​**`SHOW CREATE PROCEDURE`**​：MySQL专用命令，用于显示存储过程的创建语句
    
- ​**`存储过程名称`**​：要查看的具体存储过程的名字
    
- ​**返回信息**​：完整的CREATE PROCEDURE语句，包括参数列表和过程体
    

## 四、 删除存储过程命令解读

```
DROP PROCEDURE [IF EXISTS] 存储过程名称;
```

​**各项含义解读：​**​

- ​**`DROP PROCEDURE`**​：删除存储过程的固定语法结构
    
- ​**`[IF EXISTS]`**​：可选关键字，含义和作用：
    
    - ​**作用**​：安全防护机制，避免因存储过程不存在而报错
        
    - ​**有IF EXISTS时**​：如果存储过程不存在，执行不会报错，只产生警告
        
    - ​**无IF EXISTS时**​：如果存储过程不存在，执行会报错并中断
        
    
- ​**`存储过程名称`**​：要删除的特定存储过程的名称
    

