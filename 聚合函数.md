- 定义：将某一列数据作为一个整体，进行纵向计算
### **核心聚合函数表**

| 函数              | 作用       | 空值处理      | 示例（基于电商数据）                                               |
| --------------- | -------- | --------- | -------------------------------------------------------- |
| ​**`COUNT()`**​ | 统计行数     | 忽略 `NULL` | `SELECT COUNT(*) FROM users;`  <br>（统计用户总数）              |
| ​**`SUM()`**​   | 计算数值列总和  | 忽略 `NULL` | `SELECT SUM(total_amount) FROM orders;`  <br>（计算所有订单总金额） |
| ​**`AVG()`**​   | 计算数值列平均值 | 忽略 `NULL` | `SELECT AVG(price) FROM products;`  <br>（商品平均价格）         |
| ​**`MAX()`**​   | 返回最大值    | 忽略 `NULL` | `SELECT MAX(order_date) FROM orders;`  <br>（最近订单日期）      |
| ​**`MIN()`**​   | 返回最小值    | 忽略 `NULL` | `SELECT MIN(stock_quantity) FROM products;`  <br>（最低库存量） |
### **进阶用法与技巧**​

#### 1. ​**`COUNT()`的三种形式**​


```
-- 统计VIP用户数量（忽略NULL）
SELECT COUNT(is_vip) FROM users;  

-- 统计有邮箱的用户数（排除NULL）
SELECT COUNT(email) FROM users;  

-- 统计所有行数（含NULL）
SELECT COUNT(*) FROM orders;
```

#### 2. ​**`DISTINCT`去重统计**​



```
-- 统计有订单的用户数（去重）
SELECT COUNT(DISTINCT user_id) FROM orders;  

-- 计算不同城市的用户数
SELECT COUNT(DISTINCT city) FROM user_addresses;
```

#### 3. ​**`GROUP BY`分组聚合**​


```
-- 按类别统计商品平均价格
SELECT category, AVG(price) 
FROM products 
GROUP BY category;

-- 按用户统计订单总量和总金额
SELECT user_id, COUNT(*) AS order_count, SUM(total_amount) AS total_spent
FROM orders
GROUP BY user_id;
```

#### 4. ​**`HAVING`过滤分组结果**​



```
-- 筛选总消费超过500的用户
SELECT user_id, SUM(total_amount) AS total_spent
FROM orders
GROUP BY user_id
HAVING total_spent > 500;  -- 注意：HAVING在聚合后执行

-- 查找订单数超过3个的用户
SELECT user_id, COUNT(*) AS order_count
FROM orders
GROUP BY user_id
HAVING order_count > 3;
```

#### 5. ​**组合聚合函数**​



```
-- 同时计算价格的最大值、最小值、平均值
SELECT 
    MAX(price) AS max_price,
    MIN(price) AS min_price,
    AVG(price) AS avg_price
FROM products;
```

---

### ​**特殊场景处理**​

#### 1. ​**空集处理**​


```
-- 使用IFNULL避免返回NULL
SELECT AVG(IFNULL(account_balance, 0)) FROM users;
```

#### 2. ​**条件聚合**​



```
-- 统计VIP和非VIP用户数量
SELECT 
    COUNT(CASE WHEN is_vip = 1 THEN 1 END) AS vip_count,
    COUNT(CASE WHEN is_vip = 0 THEN 1 END) AS non_vip_count
FROM users;

-- 计算电子产品的销售总额
SELECT SUM(CASE WHEN p.category = 'Electronics' THEN od.unit_price * od.quantity END) 
FROM order_details od
JOIN products p ON od.product_id = p.product_id;
```

---

### ​**经典面试题示例**​

#### Q1：查询消费金额最高的前3名用户


```
SELECT 
    u.user_id, 
    u.username,
    SUM(o.total_amount) AS total_spent
FROM users u
JOIN orders o ON u.user_id = o.user_id
GROUP BY u.user_id, u.username
ORDER BY total_spent DESC
LIMIT 3;
```

#### Q2：找出库存量低于平均库存的商品


```
SELECT product_name, stock_quantity
FROM products
WHERE stock_quantity < (SELECT AVG(stock_quantity) FROM products);
```

---

### ​**注意事项**​

1. ​**聚合函数忽略 `NULL`值**​：如 `AVG(price)`不计算 `price`为 `NULL`的行
    
2. ​**`GROUP BY`必须包含所有非聚合列**​：否则会报语法错误
    
3. ​**性能优化**​：对聚合字段加索引（如 `orders.total_amount`）
    

通过组合这些函数，您可以完成从基础统计到复杂分析的各类查询任务。建议在您的电商数据库上实际运行这些示例加深理解！