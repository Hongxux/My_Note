
存储函数是 MySQL 中一种重要的数据库对象，它封装了一段可重用的逻辑并**返回一个单一的值**。图中内容可以总结为以下几个要点：

#### 一、 存储函数的核心特点

1. ​**拥有返回值**​：这是存储函数与存储过程最根本的区别。存储函数必须通过 `RETURN`语句返回一个标量值（如一个整数、字符串或日期）。
    
2. ​**参数模式固定**​：存储函数的参数**只能是 `IN`类型**​（即输入参数）。您不能像存储过程那样定义 `OUT`或 `INOUT`参数。
    

#### 二、 创建存储函数的语法结构

图中给出了创建存储函数的标准语法框架。一个完整的存储函数定义如下：

```
CREATE FUNCTION 函数名([参数列表])
RETURNS 返回值的数据类型
[函数特性]
BEGIN
    -- 函数体：SQL 语句逻辑
    RETURN 返回值; -- 必须包含 RETURN 语句
END;
```

​**关键组成部分解析：​**​

- ​**`CREATE FUNCTION 函数名`**​：声明要创建的存储函数的名称。
    
- ​**`([参数列表])`**​：定义输入参数，格式为 `参数名 参数数据类型`。例如：`(employee_id INT)`。参数是可选的，但如果有，则必须为 `IN`类型（关键字 `IN`通常可省略）。
    
- ​**`RETURNS 返回值的数据类型`**​：​**必须明确声明**函数返回值的数据类型，例如 `RETURNS VARCHAR(50)`或 `RETURNS INT`。
    
- ​**`[函数特性]`**​：描述函数行为的特性，下图会详细说明。
    
- ​**`BEGIN ... END`**​：包含函数执行逻辑的语句块。
    
- ​**`RETURN 返回值;`**​：​**函数体内必须至少包含一条 ​**`RETURN`**​ 语句**，用于指定函数的返回值。
    

#### 三、 函数特性详解

图中特别对 `characteristic`（函数特性）进行了说明，这是保证函数正确性和优化性能的关键。

|特性|含义|适用场景|
|---|---|---|
|​**`DETERMINISTIC`**​|​**确定性**。表示对于相同的输入参数，函数**总是返回完全相同的结果**。|如：`加密函数`、`数学运算函数`。这有助于优化器缓存结果。|
|​**`NOT DETERMINISTIC`**​|​**非确定性**。表示即使输入参数相同，函数**也可能返回不同的结果**。|如：`返回当前时间`的函数 `NOW()`、`返回随机数`的函数 `RAND()`。这是**默认**特性。|
|​**`NO SQL`**​|声明函数体**不包含任何 SQL 语句**。|函数只进行简单的计算或逻辑判断，不读写数据库。|
|​**`READS SQL DATA`**​|声明函数体会**读取数据**​（如 `SELECT`），但不会修改数据。|最常用的特性，适用于基于查询结果进行计算的函数。|

​**注意**​：在大多数 MySQL 配置中，特别是开启了二进制日志时，​**必须明确指定函数是 `DETERMINISTIC`、`NO SQL`还是 `READS SQL DATA`**，否则创建函数可能会失败。

### 一个完整的示例

假设需要创建一个函数，根据员工ID查询其所属的部门名称。

```
-- 设置语句分隔符，以便在函数体内使用分号
DELIMITER $$

CREATE FUNCTION GetEmployeeDepartment(emp_id INT)
RETURNS VARCHAR(50)
READS SQL DATA -- 特性：函数内包含读取数据的SQL
BEGIN
    -- 声明变量用于存储部门名称
    DECLARE dept_name VARCHAR(50);

    -- 查询逻辑：通过SELECT...INTO为变量赋值
    SELECT department_name INTO dept_name
    FROM employees e
    JOIN departments d ON e.department_id = d.id
    WHERE e.id = emp_id;

    -- 返回结果
    RETURN dept_name;
END
$$

DELIMITER ; -- 将分隔符改回分号
```

​**调用该函数：​**​

```
-- 像使用内置函数一样使用它
SELECT id, name, GetEmployeeDepartment(id) AS department
FROM employees WHERE id = 123;
```

### 总结

这张图的核心在于说明：

1. ​**存储函数的核心是返回值**，通过 `RETURN`语句实现。
    
2. 其语法结构严谨，必须包含 `RETURNS`关键字来定义返回类型。
    
3. 正确声明**函数特性**​（如 `READS SQL DATA`）对于函数的成功创建和高效运行至关重要。
    

掌握存储函数后，您可以将复杂的计算或查询逻辑封装起来，在 SQL 语句中像使用内置函数（如 `COUNT()`, `UPPER()`）一样方便地调用，极大地提高了代码的复用性和可读性。