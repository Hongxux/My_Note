---
aliases:
  - 动态密钥轮换
---
- 需求背景：
	- **防止令牌伪造与数据篡改**：JWT 的签名用于验证令牌的完整性和真实性。如果签名密钥泄露，攻击者便能伪造任意用户的合法令牌，或篡改令牌内的关键信息（如用户身份、权限），从而严重威胁系统安全
	- **应对密钥泄露风险**：密钥可能因代码误提交、配置文件泄露、日志记录或内部人员风险而暴露。若系统长期使用单一固定密钥，一旦泄露，后果严重，全线业务都可能受到影响
- 解决措施：动态密钥轮换
	- 设计目的：在用户无感知的情况下更新密钥，避免大规模下线
	- 核心思路：
		- 采用密钥标识（Key ID, 即 `kid`）表示密匙的版本号
			- 存储位置：JWT头部
			- 含义：标识所用密钥版本。
		- 多版本密钥共存机制
			- 目的：确保新旧密钥兼容以避免服务中断，避免大规模下线
			- 工作流程：
				- 签发新令牌：使用新私钥签名
				- 验证令牌：服务端根据 `kid`查找对应的公钥进行验签
					- 旧密钥在一定宽限期内仍需保留以供验签，但不再用于新签名。
						- 宽限期设置：覆盖已签发令牌的有效期
				- 清理旧密钥：通过定时任务清理过期的旧密钥
	- 密匙存储：需要一个安全的密钥仓库（KeyStore）来管理不同版本的密钥对，支持按 `kid`查询