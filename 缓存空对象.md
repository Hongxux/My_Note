![[Pasted image 20251118140041.png]]
- **做法**：当从数据库查询不到数据时，我们仍然将这个空结果（例如，`null`或一个特殊的空对象）进行缓存，**并设置一个较短的过期时间（比如2-5分钟）**。
    ![[Pasted image 20251118140127.png]]
- **优点**：实现简单
    
- **缺点**：
    - 额外的内存消耗（存了垃圾的空对象)
	    - 通过设置短TTL可以缓解
    -  可能造成短期的不一致
	    - 在空值缓存的短时间内，如果数据库新增了该数据，会出现短暂的数据不一致（需要等待空值过期或主动删除空值缓存）。
**代码示例：**
```java
public <R,ID> R queryAvoidPassThrough(String preKey, ID id, Class<R> cls, Function<ID,R> queryFromDBbyID,Long expireTime, TimeUnit timeUnit){
    String json = stringRedisTemplate.opsForValue().get(preKey + id);
    if(StrUtil.isNotBlank(json)){
        // 缓存命中，且不是空值
        return JSONUtil.toBean(json, cls);
    }
    
    // 注意：这里用 `== null` 判断，代表缓存完全不存在这个key
    if(json == null){
        R r = queryFromDBbyID.apply(id);
        if(r != null){
            // 数据库存在，写入缓存
            set(preKey+id, r, expireTime, timeUnit);
            return r;
        } else {
            // 数据库也不存在，缓存空值（例如空字符串），并设置较短过期时间
            stringRedisTemplate.opsForValue().set(preKey+id, "", 5, TimeUnit.MINUTES);
            return null;
        }
    }
    
    // 执行到这里，说明 json 是空字符串（""），代表之前缓存的空值
    return null;
}
```